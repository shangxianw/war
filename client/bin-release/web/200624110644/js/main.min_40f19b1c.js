function neww(t){return PoolManager.Ins().pop(t)}function deletee(t){PoolManager.Ins().push(t)}function removee(t){PoolManager.Ins().push(t)}var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(a,i){function o(t){try{l(n.next(t))}catch(e){i(e)}}function s(t){try{l(n["throw"](t))}catch(e){i(e)}}function l(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(o,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return n([t,e])}}function n(r){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,i&&(o=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){l.label=r[1];break}if(6===r[0]&&l.label<o[1]){l.label=o[1],o=r;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(r);break}o[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(n){r=[6,n],i=0}finally{a=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,i,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},DataBase=function(){function t(){this.initAll()}return t.prototype.initAll=function(){this.uniqueCode=IDManager.Ins().getNewId(),this.init()},t.prototype.destroyAll=function(){this.removeAllAttrListener(),this._attrHash=null,this.removeAllAttCB(),this._otherAttrHash=null,this.destroy()},t.prototype.addAttrListener=function(t,e,r,n,a){if(void 0===n&&(n=!0),void 0===a&&(a=null),0==LogUtils.CheckParamValid(t,e,r))return!1;0==this.hash.has(t)&&this.hash.set(t,[]);for(var i=this.hash.get(t),o=0,s=i;o<s.length;o++){var l=s[o];if(l.cbFn==e&&l.thisObj==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+r+" 重复注册 "+t),!1}var h=(new CBData).packData(e,r,a);return i.push(h),1==n&&h.exec(),!0},t.prototype.removeAttrListener=function(t,e,r){if(0==LogUtils.CheckParamValid(t,e,r))return!1;if(0==this.hash.has(t))return!0;for(var n,a=this.hash.get(t),i=0,o=a.length;o>i;i++)if(n=a[i],null!=n){if(n.cbFn==e&&n.thisObj==r)return a.splice(i,1),n.destroy(),n=null,!0}else LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+this+" 没有注册 "+t),!1},t.prototype.removeAllAttrListener=function(){for(var t=0,e=this.hash.values();t<e.length;t++){for(var r=e[t],n=0,a=r;n<a.length;n++){var i=a[n];i.destroy(),i=null}r.length=0}this.hash.destroy()},t.prototype.setAttr=function(t,e){return 0==LogUtils.CheckParamValid(t)?!1:(Object.defineProperty(this,t,{value:e,writable:!0}),void this.updateAttr(t))},t.prototype.updateAttr=function(t){if(0==LogUtils.CheckParamValid(t))return!1;0==this.hash.has(t)&&LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 没有注册 "+t);for(var e=0,r=this.hash.values();e<r.length;e++){var n=r[e];if(null==n)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");for(var a=0,i=n;a<i.length;a++){var o=i[a];o.exec()}}},t.prototype.addAttrCB=function(t,e,r,n,a,i){if(void 0===a&&(a=!0),void 0===i&&(i=null),0==LogUtils.CheckParamValid(t,e,r,n))return!1;0==this.otherAttrHash.has(t)&&this.otherAttrHash.set(t,new Hash);var o=this.otherAttrHash.get(t);0==o.has(e)&&o.set(e,[]);for(var s=o.get(e),l=0,h=s;l<h.length;l++){var u=h[l];if(u.cbFn==r&&u.thisObj==n)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+n+" 重复注册 "+e),!1}var p=(new CBData).packData(r,n,i);return s.push(p),1==a&&p.exec(),!0},t.prototype.removeAttrCB=function(t,e,r,n){if(0==LogUtils.CheckParamValid(t,e,r,n))return!1;if(0==this.otherAttrHash.has(t))return!0;var a=this.otherAttrHash.get(t);if(0==a.has(e))return!0;for(var i=a.get(e),o=0,s=i;o<s.length;o++){var l=s[o];if(l.cbFn==r&&l.thisObj==n)return!0}return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+this+" 没有注册 "+e),!1},t.prototype.removeAllAttCB=function(){for(var t=0,e=this.otherAttrHash.values();t<e.length;t++){for(var r=e[t],n=0,a=r.values();n<a.length;n++){for(var i=a[n],o=0,s=i;o<s.length;o++){var l=s[o];l.destroy(),l=null}i.length=0}r.destroy(),r=null}this.otherAttrHash.destroy()},Object.defineProperty(t.prototype,"hash",{get:function(){return null==this._attrHash&&(this._attrHash=new Hash),this._attrHash},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otherAttrHash",{get:function(){return null==this._otherAttrHash&&(this._otherAttrHash=new Hash),this._otherAttrHash},enumerable:!0,configurable:!0}),t}();__reflect(DataBase.prototype,"DataBase");var CBData=function(){function t(){}return t.prototype.init=function(){},t.prototype.destroy=function(){},t.prototype.packData=function(t,e,r){return void 0===r&&(r=null),this.cbFn=t,this.thisObj=e,this.param=r,this},t.prototype.exec=function(t){(null==this.cbFn||null==this.thisObj)&&(null!=this.param?this.cbFn.call(this.thisObj,this.param,t):this.cbFn.call(this.thisObj,t))},t}();__reflect(CBData.prototype,"CBData");var UIBase=function(t){function e(e,r){void 0===e&&(e=null),void 0===r&&(r=null);var n=t.call(this)||this;return null!=e&&(n.skinName=e),n.initAll(r),n}return __extends(e,t),e.prototype.init=function(){},e.prototype.initAll=function(t){void 0===t&&(t=null),this.uniqueCode=IDManager.Ins().getNewId(),this.touchList=[],this.init()},e.prototype.destroyAll=function(){this.removeAllEvent(),this.removeAllAttrListener(),this.destroy()},e.prototype.addAttrListener=function(t,e,r,n,a){if(void 0===n&&(n=!0),void 0===a&&(a=null),0==LogUtils.CheckParamValid(t,e,r))return!1;0==this.hash.has(t)&&this.hash.set(t,[]);for(var i=this.hash.get(t),o=0,s=i;o<s.length;o++){var l=s[o];if(l.cbFn==e&&l.thisObj==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+r+" 重复注册 "+t),!1}var h=(new CBData).packData(e,r,a);return i.push(h),1==n&&h.exec(),!0},e.prototype.removeAttrListener=function(t,e,r){if(0==LogUtils.CheckParamValid(t,e,r))return!1;if(0==this.hash.has(t))return!0;for(var n,a=this.hash.get(t),i=0,o=a.length;o>i;i++)if(n=a[i],null!=n){if(n.cbFn==e&&n.thisObj==r)return a.splice(i,1),n.destroy(),n=null,!0}else LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+this+" 没有注册 "+t),!1},e.prototype.removeAllAttrListener=function(){for(var t=0,e=this.hash.values();t<e.length;t++){for(var r=e[t],n=0,a=r;n<a.length;n++){var i=a[n];i.destroy(),i=null}r.length=0}this.hash.destroy()},e.prototype.setAttr=function(t,e){return 0==LogUtils.CheckParamValid(t)?!1:(Object.defineProperty(this,t,{value:e,writable:!0}),void this.updateAttr(t))},e.prototype.updateAttr=function(t){if(0==LogUtils.CheckParamValid(t))return!1;0==this.hash.has(t)&&LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 没有注册 "+t);for(var e=0,r=this.hash.values();e<r.length;e++){var n=r[e];if(null==n)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");for(var a=0,i=n;a<i.length;a++){var o=i[a];o.exec()}}},e.prototype.addAttrCB=function(t,e,r,n,a,i){if(void 0===a&&(a=!0),void 0===i&&(i=null),0==LogUtils.CheckParamValid(t,e,r,n))return!1;0==this.otherAttrHash.has(t)&&this.otherAttrHash.set(t,new Hash);var o=this.otherAttrHash.get(t);0==o.has(e)&&o.set(e,[]);for(var s=o.get(e),l=0,h=s;l<h.length;l++){var u=h[l];if(u.cbFn==r&&u.thisObj==n)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+n+" 重复注册 "+e),!1}var p=(new CBData).packData(r,n,i);return s.push(p),1==a&&p.exec(),!0},e.prototype.removeAttrCB=function(t,e,r,n){if(0==LogUtils.CheckParamValid(t,e,r,n))return!1;if(0==this.otherAttrHash.has(t))return!0;var a=this.otherAttrHash.get(t);if(0==a.has(e))return!0;for(var i=a.get(e),o=0,s=i;o<s.length;o++){var l=s[o];if(l.cbFn==r&&l.thisObj==n)return!0}return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+this+" 没有注册 "+e),!1},e.prototype.removeAllAttCB=function(){for(var t=0,e=this.otherAttrHash.values();t<e.length;t++){for(var r=e[t],n=0,a=r.values();n<a.length;n++){for(var i=a[n],o=0,s=i;o<s.length;o++){var l=s[o];l.destroy(),l=null}i.length=0}r.destroy(),r=null}this.otherAttrHash.destroy()},Object.defineProperty(e.prototype,"hash",{get:function(){return null==this._attrHash&&(this._attrHash=new Hash),this._attrHash},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"otherAttrHash",{get:function(){return null==this._otherAttrHash&&(this._otherAttrHash=new Hash),this._otherAttrHash},enumerable:!0,configurable:!0}),e.prototype.addEvent=function(t,e,r,n){if(null==t||null==r||null==n||null==e||""==e)return LogUtils.Error("参数有误"),!1;for(var a=0,i=this.touchList;a<i.length;a++){var o=i[a];if(null!=o&&o.target==t&&o.cbFn==r&&o.thisObj==n&&o.type==e)return LogUtils.Error("重复注册"),!1}var s=PoolManager.Ins().pop(TouchData);return s.packData(t,e,r,n),this.touchList.push(s),!0},e.prototype.removeEvent=function(t,e,r,n){if(null==t||null==r||null==n||null==e||""==e)return LogUtils.Error("参数有误"),!1;for(var a=0,i=this.touchList;a<i.length;a++){var o=i[a];if(null!=o&&o.target==t&&o.type==e&&o.cbFn==r&&o.thisObj==n&&o.type==e){var s=this.touchList.indexOf(o);return s>=0?(this.touchList.splice(s,1),o.destroyAll(),PoolManager.Ins().push(o),!0):!1}}return!1},e.prototype.removeAllEvent=function(){for(var t=DataUtils.CopyArray(this.touchList),e=0,r=t;e<r.length;e++){var n=r[e];null!=n&&(n.destroyAll(),PoolManager.Ins().push(n))}this.touchList.length=0},e}(eui.Component);__reflect(UIBase.prototype,"UIBase");var TouchData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){ListenerMgr.Ins().removeEventListen(this.target,this.type,this.cbFn,this.thisObj)},e.prototype.packData=function(t,e,r,n){return this.target=t,this.type=e,this.cbFn=r,this.thisObj=n,ListenerMgr.Ins().addEventListen(this.target,this.type,this.cbFn,this.thisObj),this},e.prototype.exec=function(t){null!=this.cbFn&&null!=this.thisObj&&this.cbFn.call(this.thisObj,t)},e}(DataBase);__reflect(TouchData.prototype,"TouchData");var ViewData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){},e.prototype.initAll=function(){t.prototype.initAll.call(this)},e.prototype.destroyAll=function(){t.prototype.destroyAll.call(this)},e}(DataBase);__reflect(ViewData.prototype,"ViewData");var ViewBase=function(t){function e(e,r){return t.call(this,e,r)||this}return __extends(e,t),e.prototype.initAll=function(e){this.viewInfo=new e,this.info=this.viewInfo,t.prototype.initAll.call(this)},e.prototype.destroyAll=function(){t.prototype.destroyAll.call(this)},e}(UIBase);__reflect(ViewBase.prototype,"ViewBase");var DevelopMode;!function(t){t[t.DEBUG=1]="DEBUG",t[t.PUBLISH=2]="PUBLISH"}(DevelopMode||(DevelopMode={}));var STR_CONST=function(){function t(){}return t.DESTROY="destroy",t.INIT="init",t.FUNCTION="function",t.ARRAY="array",t}();__reflect(STR_CONST.prototype,"STR_CONST");var SYSTEM;!function(t){t[t.COLLISION=1]="COLLISION",t[t.FALL=2]="FALL",t[t.MOVE=3]="MOVE",t[t.CAMERA=4]="CAMERA"}(SYSTEM||(SYSTEM={}));var KEY_CODE;!function(t){t[t.W=87]="W",t[t.S=83]="S",t[t.A=65]="A",t[t.D=68]="D",t[t.SPACE=32]="SPACE",t[t.Z=90]="Z",t[t.X=88]="X"}(KEY_CODE||(KEY_CODE={}));var ENTITY_ID;!function(t){t[t.MAP=1]="MAP",t[t.PLAYER=2]="PLAYER",t[t.CAMERA=3]="CAMERA",t[t.CANDLE=4]="CANDLE"}(ENTITY_ID||(ENTITY_ID={}));var RIGID_TYPE;!function(t){t[t.RECT=1]="RECT",t[t.CIRCLE=2]="CIRCLE"}(RIGID_TYPE||(RIGID_TYPE={}));var CONFIG=function(){function t(){}return t.HERO="hero_json",t.UPGRADE="upgrade_json",t}();__reflect(CONFIG.prototype,"CONFIG");var WItemRenderBase=function(t){function e(e,r){void 0===e&&(e=null),void 0===r&&(r=null);var n=t.call(this)||this;return null!=e&&(n.skinName=e),n.initAll(r),n}return __extends(e,t),e.prototype.init=function(){},e.prototype.initAll=function(t){void 0===t&&(t=null),this.id=IDManager.Ins().getNewId(),this.touchList=[],this.init()},e.prototype.destroyAll=function(){this.removeAllEvent(),this.removeAllAttrListener(),this.destroy()},e.prototype.addAttrListener=function(t,e,r,n){if(void 0===n&&(n=null),null==t||null==e||null==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1;0==this.hash.has(t)&&this.hash.set(t,[]);for(var a=this.hash.get(t),i=0,o=a;i<o.length;i++){var s=o[i];if(s.cbFn==e&&s.thisObj==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+r+" 重复注册 "+t),!1}var l=(new CBData).packData(e,r,n);return a.push(l),!0},e.prototype.removeAttrListener=function(t,e,r){if(null==t||null==e||null==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1;if(0==this.hash.has(t))return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+r+" 没有注册 "+t),!0;for(var n,a=this.hash.get(t),i=0,o=a.length;o>i;i++)if(n=a[i],null!=n){if(n.cbFn==e&&n.thisObj==r)return a.splice(i,1),n.destroy(),n=null,!0}else LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+this+" 没有注册 "+t),!1},e.prototype.hasAttrListener=function(t,e,r){if(null==t||null==e||null==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1;if(0==this.hash.has(t))return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+r+" 没有注册 "+t),!1;for(var n,a=this.hash.get(t),i=0,o=a.length;o>i;i++)if(n=a[i],null!=n){if(n.cbFn==e&&n.thisObj==r)return!0}else LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+r+" 没有注册 "+t),!1},e.prototype.setAttr=function(t,e){return null==t?(LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1):(Object.defineProperty(this,t,{value:e,writable:!0}),void this.updateAttr(t))},e.prototype.updateAttr=function(t){if(null==t)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1;0==this.hash.has(t)&&LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 没有注册 "+t);for(var e=0,r=this.hash.values();e<r.length;e++){var n=r[e];if(null==n)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 发现空对象");for(var a=0,i=n;a<i.length;a++){var o=i[a];o.exec()}}},e.prototype.removeAllAttrListener=function(){for(var t=0,e=this.hash.values();t<e.length;t++){for(var r=e[t],n=0,a=r;n<a.length;n++){var i=a[n];i.destroy(),i=null}r.length=0}this.hash.destroy()},e.prototype.addEvent=function(t,e,r,n){if(null==t||null==r||null==n||null==e||""==e)return LogUtils.Error("参数有误"),!1;for(var a=0,i=this.touchList;a<i.length;a++){var o=i[a];if(null!=o&&o.target==t&&o.cbFn==r&&o.thisObj==n&&o.type==e)return LogUtils.Error("重复注册"),!1}var s=PoolManager.Ins().pop(TouchData);return s.packData(t,e,r,n),this.touchList.push(s),!0},e.prototype.removeEvent=function(t,e,r,n){if(null==t||null==r||null==n||null==e||""==e)return LogUtils.Error("参数有误"),!1;for(var a=0,i=this.touchList;a<i.length;a++){var o=i[a];if(null!=o&&o.target==t&&o.type==e&&o.cbFn==r&&o.thisObj==n&&o.type==e){var s=this.touchList.indexOf(o);return s>=0?(this.touchList.splice(s,1),o.destroyAll(),PoolManager.Ins().push(o),!0):!1}}return!1},e.prototype.removeAllEvent=function(){for(var t=DataUtils.CopyArray(this.touchList),e=0,r=t;e<r.length;e++){var n=r[e];null!=n&&(n.destroyAll(),PoolManager.Ins().push(n))}this.touchList.length=0},Object.defineProperty(e.prototype,"hash",{get:function(){return null==this._hash&&(this._hash=new Hash),this._hash},enumerable:!0,configurable:!0}),e}(eui.ItemRenderer);__reflect(WItemRenderBase.prototype,"WItemRenderBase");var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.resGroup=[],this.layer=LayerManager.Ins().Panel},e.prototype.destroy=function(){},e.prototype.packData=function(){},e}(ViewData);t.DemoPanelData=e,__reflect(e.prototype,"home.DemoPanelData");var r=function(t){function r(){return t.call(this,"DemoPanelSkin",e)||this}return __extends(r,t),r.prototype.init=function(){},r.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},r.prototype.initData=function(t){this.info.packData()},r.prototype.initView=function(){},r}(ViewBase);t.DemoPanel=r,__reflect(r.prototype,"home.DemoPanel")}(home||(home={}));var war;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initAll=function(){t.prototype.initAll.call(this)},e.prototype.destroyAll=function(){t.prototype.destroyAll.call(this)},e}(DataBase);t.ComBase=e,__reflect(e.prototype,"war.ComBase")}(war||(war={}));var war;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initAll=function(){this.comMap=new Hash,this.touchEnabled=!1,this.touchChildren=!1,t.prototype.initAll.call(this)},e.prototype.destroyAll=function(){DataUtils.DestroyDataBaseMap(this.comMap),t.prototype.destroyAll.call(this)},e.prototype.getCom=function(t){return this.comMap.get(t)},e.prototype.removeCom=function(t){var e=this.comMap.remove(t);null!=e&&(e.destroyAll(),PoolManager.Ins().push(e))},e.prototype.setCom=function(t){1!=this.comMap.has(t.componentId)&&this.comMap.set(t.componentId,t)},e.prototype.hasCom=function(t){return this.comMap.has(t)},e}(UIBase);t.EntityBase=e,__reflect(e.prototype,"war.EntityBase")}(war||(war={}));var war;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.update=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},e}(DataBase);t.SystemBase=e,__reflect(e.prototype,"war.SystemBase")}(war||(war={}));var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){},r.prototype.destroy=function(){},r.prototype.addKa=function(e,r){var n=t.HomeDataMgr.Ins().myData.kaMap;if(1==n.has(e))return LogUtils.Error("已存在此"),!1;var a=PoolManager.Ins().pop(t.KaData);return a.packData(e,r),n.set(e,a),!0},r.prototype.removeKa=function(e){var r=t.HomeDataMgr.Ins().myData.kaMap;if(0==r.has(e))return LogUtils.Error("不存在卡"),!1;var n=r.remove(e);return n.destroyAll(),PoolManager.Ins().push(n),!0},r}(DataBase);t.KaDataMgr=e,__reflect(e.prototype,"home.KaDataMgr")}(home||(home={}));var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var DataUtils=function(){function t(){}return t.CopyArray=function(t){for(var e=[],r=0,n=t;r<n.length;r++){var a=n[r];e.push(a)}return e},t.DestroyCBDataMap=function(t,e){void 0===e&&(e=!0);for(var r=0,n=t.values();r<n.length;r++){for(var a=n[r],i=0,o=a;i<o.length;i++){var s=o[i];s.destroy(),s=null}a.length=0}t.destroy(),e&&(t=null)},t.DestroyDataBaseMap=function(t,e){void 0===e&&(e=!0);var r;for(var n in t.values)r=t.get(n),null!=r&&(r.destroyAll(),PoolManager.Ins().push(r));t.destroy(),1==e&&(t=null)},t.DestroyUIBaseMap=function(t,e){void 0===e&&(e=!0);for(var r=0,n=t.values();r<n.length;r++){var a=n[r];null!=a&&(a.destroyAll(),PoolManager.Ins().push(a))}t.destroy(),1==e&&(t=null)},t.DestroyDataBaseArray=function(t,e){void 0===e&&(e=!0);for(var r=0,n=t;r<n.length;r++){var a=n[r];a.destroyAll(),PoolManager.Ins().push(a)}t.length=0,1==e&&(t=null)},t.DestroyUIBaseArray=function(t,e){void 0===e&&(e=!0);for(var r=0,n=t;r<n.length;r++){var a=n[r];a.destroyAll(),PoolManager.Ins().push(a)}t.length=0,1==e&&(t=null)},t.DestroyDataBaseClass=function(t,e){void 0===e&&(e=!0),null!=t&&(t.destroyAll(),1==e&&(t=null))},t}();__reflect(DataUtils.prototype,"DataUtils");var Demo=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){},e.Ins=function(){return null==e.Instance&&(e.Instance=new e),e.Instance},e}(DataBase);__reflect(Demo.prototype,"Demo");var GameData=function(){function t(){}return t.DevelopMode=DevelopMode.DEBUG,t}();__reflect(GameData.prototype,"GameData");var GameUtils=function(){function t(){}return Object.defineProperty(t,"StageWidth",{get:function(){return t.main.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"StageHeight",{get:function(){return t.main.stage.stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ScreenWidth",{get:function(){return document.documentElement.clientWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ScreenHeight",{get:function(){return document.documentElement.clientHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Stage",{get:function(){return t.main.stage},enumerable:!0,configurable:!0}),Object.defineProperty(t,"StageCenterX",{get:function(){return this.StageWidth/2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"StageCenterY",{get:function(){return this.StageHeight/2},enumerable:!0,configurable:!0}),t}();__reflect(GameUtils.prototype,"GameUtils");var Hash=function(){function t(){this.init()}return t.prototype.init=function(){this.keyArray=[],this.valueArray=[]},t.prototype.destroy=function(){for(var t=0,e=this.valueArray;t<e.length;t++){var r=e[t];r=null}for(var n=0,a=this.keyArray;n<a.length;n++){var r=a[n];r=null}this.valueArray.length=0,this.keyArray.length=0},t.prototype.set=function(t,e){this.keyArray.push(t),this.valueArray.push(e)},t.prototype.remove=function(t){var e=this.keyArray.indexOf(t);return 0>e?null:(this.keyArray.splice(e,1),this.valueArray.splice(e,1)[0])},t.prototype.get=function(t){var e=this.keyArray.indexOf(t);return 0>e?null:this.valueArray[e]},t.prototype.has=function(t){return this.keyArray.indexOf(t)>=0},Object.defineProperty(t.prototype,"len",{get:function(){return this.keyArray.length},enumerable:!0,configurable:!0}),t.prototype.values=function(){return this.valueArray},t.prototype.keys=function(){return this.keyArray},t}();__reflect(Hash.prototype,"Hash");var IDManager=function(){function t(){this.init()}return t.prototype.init=function(){this.newId=0},t.prototype.destroy=function(){this.newId=0},t.prototype.getNewId=function(){return this.newId++,this.newId},t.Ins=function(){return null==t.Instance&&(t.Instance=new t),t.Instance},t}();__reflect(IDManager.prototype,"IDManager");var LayerManager=function(){function t(){this.init()}return t.prototype.init=function(){var t=GameUtils.main;return null==t?LogUtils.Warn("no Main"):(this.War=new eui.UILayer,this.War.name="War",this.War.touchEnabled=!1,t.addChild(this.War),this.Main=new eui.UILayer,this.Main.name="Main",this.Main.touchEnabled=!1,t.addChild(this.Main),this.Panel=new eui.UILayer,this.Panel.name="Panel",this.Panel.touchEnabled=!1,t.addChild(this.Panel),this.Menu=new eui.UILayer,this.Menu.name="Menu",this.Menu.touchEnabled=!1,t.addChild(this.Menu),this.Tips=new eui.UILayer,this.Tips.name="Tips",this.Tips.touchEnabled=!1,void t.addChild(this.Tips))},t.prototype.destroy=function(){},t.Ins=function(){return null==t.Instance&&(t.Instance=new t),t.Instance},t}();__reflect(LayerManager.prototype,"LayerManager");var ListenerMgrData=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.obj=null,this.type=null,this.cbFn=null,this.thisObj=null},e.prototype.destroy=function(){this.obj.removeEventListener(this.type,this.cbFn,this.thisObj)},e.prototype.packData=function(t,e,r,n){return this.obj=t,this.type=e,this.cbFn=r,this.thisObj=n,this.obj.addEventListener(this.type,this.cbFn,this.thisObj),this},e}(DataBase);__reflect(ListenerMgrData.prototype,"ListenerMgrData");var ListenerMgr=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.listenerMap=new Hash},e.prototype.destroy=function(){for(var t=0,e=this.listenerMap.values();t<e.length;t++)for(var r=e[t],n=0,a=r;n<a.length;n++){var i=a[n];i.destroyAll()}this.listenerMap.destroy(),this.listenerMap=null},e.prototype.addEventListen=function(t,e,r,n){if(null==t||null==e||null==r||null==n)return LogUtils.Error("参数有误"),!1;0==this.listenerMap.has(t)&&this.listenerMap.set(t,[]);for(var a=this.listenerMap.get(t),i=0,o=a;i<o.length;i++){var s=o[i];if(null!=s&&s.obj==t&&s.type==e&&s.cbFn==r&&s.thisObj==n)return LogUtils.Error("监听函数重复注册，可尝试换一个回调函数"),!1}var l=PoolManager.Ins().pop(ListenerMgrData);return l.packData(t,e,r,n),a.push(l),!0},e.prototype.removeEventListen=function(t,e,r,n){if(null==t||null==e||null==r||null==n)return LogUtils.Error("参数有误"),!1;if(0==this.listenerMap.has(t))return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : "+n+" 没有注册 "+e),!0;for(var a=this.listenerMap.get(t),i=0,o=a;i<o.length;i++){var s=o[i];if(null!=s&&s.obj==t&&s.type==e&&s.cbFn==r&&s.thisObj==n){var l=a.indexOf(s);return l>=0&&(a.splice(l,1),a.length<=0&&this.listenerMap.remove(t)),s.destroyAll(),PoolManager.Ins().push(s),!0}}return!1},e.Ins=function(){return null==e.instance&&(e.instance=new e),e.instance},e}(DataBase);__reflect(ListenerMgr.prototype,"ListenerMgr");var LogUtils=function(){function t(){}return t.Log=function(t){GameData.DevelopMode==DevelopMode.DEBUG&&console.log(t)},t.Warn=function(t){GameData.DevelopMode==DevelopMode.DEBUG&&console.warn(t)},t.Error=function(t){if(GameData.DevelopMode==DevelopMode.DEBUG){var e=(new Error).stack;console.error(t),console.error(e)}},t.CheckParamValid=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n=0,a=e;n<a.length;n++){var i=a[n];if(void 0==i)return t.Error("参数有误"),!1}return!0},t}();__reflect(LogUtils.prototype,"LogUtils");var MathUtils=function(){function t(){}return t.CalcLegSide=function(t,e){if(null==t&&null==e)return[0,0];var r=e*Math.PI/180,n=Math.cos(r)*t,a=Math.sin(r)*t;return[n,a]},t.CalcAngle=function(t,e,r,n){if(e=-e,n=-n,t==r&&e==n)return 0;if(t==r&&0>n-e)return 90;if(t==r&&n-e>0)return 270;var a=r-t,i=n-e,o=Math.sqrt(a*a+i*i),s=180*Math.acos((i*i-a*a-o*o)/(-2*a*o))/Math.PI;return i>0&&(s=180+(180-s)),s},t.IsCircleIntersect=function(t,e,r,n,a,i){var o=n-t,s=a-e,l=Math.sqrt(o*o+s*s);return r+i>l},t.CalcDistance=function(t,e,r,n,a){void 0===a&&(a=!1);var i=(r-t)*(r-t)+(n-e)*(n-e);return 0==a?i:Math.sqrt(i)},t.CheckIsCross=function(){},t}();__reflect(MathUtils.prototype,"MathUtils");var NetManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.netMap=new Hash},e.prototype.destroy=function(){this.destroySubNet(),this.removeAllNet(),this.netMap=null},e.prototype.initData=function(){this.initSubNet()},e.prototype.setNet=function(t,e,r){if(null==t||null==e||null==r)return LogUtils.Error("参数错误"),!1;0==this.netMap.has(t)&&this.netMap.set(t,[]);for(var n=this.netMap.get(t),a=0,i=n;a<i.length;a++){var o=i[a];if(o.cbFn==e&&o.thisObj==r)return LogUtils.Error("重复注册"),!1}var s=PoolManager.Ins().pop(CBData);return s.packData(e,r),n.push(s),!0},e.prototype.removeNet=function(t,e,r){if(null==t)return LogUtils.Error("参数错误"),!1;if(0==this.netMap.has(t))return LogUtils.Error("没有注册"),!1;for(var n=this.netMap.get(t),a=0,i=n;a<i.length;a++){var o=i[a];if(o.cbFn==e&&o.thisObj==r){var s=n.indexOf(o);return s>=0&&n.splice(s,1),o.destroy(),PoolManager.Ins().push(o),!0}}return!1},e.prototype.removeAllNet=function(){for(var t=0,e=this.netMap.values();t<e.length;t++){for(var r=e[t],n=0,a=r;n<a.length;n++){var i=a[n];null!=i&&(i.destroy(),PoolManager.Ins().push(i))}r.length=0}this.netMap.destroy()},e.prototype.C2SMessage=function(t,e){SocketManager.Ins().sendMessage(t,e)},e.prototype.S2CMessage=function(t,e){if(null==t||null==e)return LogUtils.Error("参数错误"),!1;if(0==this.netMap.has(t))return LogUtils.Error("没有注册"),!1;for(var r=this.netMap.get(t),n=0,a=r;n<a.length;n++){var i=a[n];i.exec(e)}return!0},e.prototype.initSubNet=function(){for(var t in net)if(0!=net.hasOwnProperty(t)){var e=net[t];"function"==typeof e.init?e.prototype.init():"function"==typeof e.prototype.init?e.prototype.init():LogUtils.Error("net "+t+" 没有初始化")}},e.prototype.destroySubNet=function(){for(var t in net)if(0!=net.hasOwnProperty(t)){var e=net[t];"function"==typeof e.destroy?e.prototype.destroy():"function"==typeof e.prototype.init?e.prototype.destroy():LogUtils.Error("net "+t+" 没有销毁")}},e.Ins=function(){return null==e.instance&&(e.instance=new e),e.instance},e}(DataBase);__reflect(NetManager.prototype,"NetManager");var PoolManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.poolMap=new Hash},e.prototype.destroy=function(){for(var t=0,e=this.poolMap.values();t<e.length;t++){var r=e[t];if(null==r)return;for(var n=0,a=r;n<a.length;n++){a[n]}}this.poolMap.destroy(),this.poolMap=null},e.prototype.push=function(t){if(null==t)return LogUtils.Warn("PoolManager:传入了一个空对象");var e=Utils.GetClassNameByObj(t);0==this.poolMap.has(e)&&this.poolMap.set(e,new Array);var r=this.poolMap.get(e);r.indexOf(t)<0&&r.push(t)},e.prototype.pop=function(t){if(0==this.poolMap.has(t.name))return new t;var e=this.poolMap.get(t.name),r=e.pop();return null==r?new t:(r.init(),r)},e.Ins=function(){return null==e.Instance&&(e.Instance=new e),e.Instance},e.prototype.checkHasListener=function(){},e}(DataBase);__reflect(PoolManager.prototype,"PoolManager");var MsgData=function(){function t(){}return t.prototype.packData=function(t,e){this.netId=t,this.data=e},t.prototype.detsroy=function(){},t}();__reflect(MsgData.prototype,"MsgData");var SocketManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.cachMsgArray=[],this.sock=new egret.WebSocket,this.sock.type=egret.WebSocket.TYPE_BINARY,this.sock.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.OnReceiveMessage,this),this.sock.addEventListener(egret.Event.CONNECT,this.OnSocketOpen,this),this.sock.addEventListener(egret.Event.CLOSE,this.OnSocketClose,this),this.sock.addEventListener(egret.IOErrorEvent.IO_ERROR,this.OnSocketError,this)},e.prototype.destroy=function(){for(var t=0,e=this.cachMsgArray;t<e.length;t++){var r=e[t];r.detsroy(),PoolManager.Ins().push(r)}this.cachMsgArray.length=0,null!=this.sock&&(this.sock.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.OnReceiveMessage,this),this.sock.removeEventListener(egret.Event.CONNECT,this.OnSocketOpen,this),this.sock.removeEventListener(egret.Event.CLOSE,this.OnSocketClose,this),this.sock.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.OnSocketError,this),this.sock.close(),this.sock=null)},e.prototype.OnSocketError=function(){},e.prototype.OnSocketClose=function(){},e.prototype.OnSocketOpen=function(){},e.prototype.OnReceiveMessage=function(){},e.prototype.sendMessage=function(t,e){},e.Ins=function(){return null==e.instance&&(e.instance=new e),e.instance},e}(DataBase);__reflect(SocketManager.prototype,"SocketManager");var TimerData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.cbFn=null,this.thisObj=null,this.delay=0,this.count=0,this.lastTime=null,this.execIm=null},e.prototype.destroy=function(){this.cbFn=null,this.thisObj=null,this.delay=0,this.count=0,this.lastTime=null,this.execIm=null},e.prototype.packData=function(t,e,r,n,a){return void 0===a&&(a=null),this.delay=t,this.cbFn=e,this.thisObj=r,this.lastTime=egret.getTimer(),this.args=a,this.execIm=n,this},e.prototype.exec=function(){return null==this.cbFn||null==this.thisObj?!1:null==this.args||0==this.args.length?this.cbFn.call(this.thisObj,this):1==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0]):2==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0],this.args[1]):3==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0],this.args[1],this.args[2]):4==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0],this.args[1],this.args[2],this.args[3]):5==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0],this.args[1],this.args[2],this.args[3],this.args[4]):6==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5]):7==this.args.length?this.cbFn.call(this.thisObj,this,this.args[0],this.args[1],this.args[2],this.args[3],this.args[4],this.args[5],this.args[6]):void 0
},e}(DataBase);__reflect(TimerData.prototype,"TimerData");var TimerManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.timerArray=[],egret.startTick(this.update,this)},e.prototype.destroy=function(){for(var t=0,e=this.timerArray;t<e.length;t++){var r=e[t];r.destroyAll(),PoolManager.Ins().push(r)}this.timerArray.length=0,egret.stopTick(this.update,this)},e.Ins=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.addTimer=function(t,e,r,n){void 0===n&&(n=!0);for(var a=[],i=4;i<arguments.length;i++)a[i-4]=arguments[i];if(null==t||null==e||null==r)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1;if(1==this.hasTimer(e,r))return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 已存在同一个定时器 "+t+" "+e+" "+r),!1;var o=PoolManager.Ins().pop(TimerData);return o.packData(t,e,r,n,a),this.timerArray.push(o),!0},e.prototype.removeTimer=function(t,e){if(null==t||null==e)return LogUtils.Warn(Utils.GetClassNameByObj(this)+" : 参数有误"),!1;for(var r=DataUtils.CopyArray(this.timerArray),n=0,a=0,i=r;a<i.length;a++){var o=i[a];if(null!=o){if(o.cbFn==t&&o.thisObj==e)return this.timerArray.splice(n,1),o.destroyAll(),PoolManager.Ins().push(o),!0;n++}}return!1},e.prototype.hasTimer=function(t,e){for(var r=DataUtils.CopyArray(this.timerArray),n=0,a=r;n<a.length;n++){var i=a[n];if(null!=i&&i.cbFn==t&&i.thisObj==e)return!0}return!1},e.prototype.update=function(t){for(var e,r=DataUtils.CopyArray(this.timerArray),n=0,a=0,i=r;a<i.length;a++){var o=i[a];if(null!=o)if(1!=o.execIm){var s=Math.floor((t-o.lastTime)/o.delay);if(s>=1){o.lastTime+=s*o.delay;for(var l=0,h=s;h>l;l++)if(o.count+=1,e=o.exec(),0==e||null==e){this.timerArray.splice(n,1),o.destroyAll(),PoolManager.Ins().push(o);break}}n++}else o.execIm=!1,o.count+=1,e=o.exec(),0==e&&(this.timerArray.splice(n,1),o.destroyAll(),PoolManager.Ins().push(o));else n++}return!0},e}(DataBase);__reflect(TimerManager.prototype,"TimerManager");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,r,n){function a(t){e.call(n,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),r.call(n))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(n,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,r){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(n,generateJSON.paths[t])},this):RES.getResByUrl(l,function(r){window.JSONParseClass.setData(r),egret.callLater(function(){e.call(n,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(n,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Utils=function(){function t(){}return t.GetClassNameByObj=function(t){var e=typeof t;if(!t||"object"!=e&&!t.prototype)return e;var r=t.prototype?t.prototype:Object.getPrototypeOf(t);if(r.hasOwnProperty("__class__"))return r.__class__;var n=r.constructor.toString().trim(),a=n.indexOf("("),i=n.substring(9,a);return Object.defineProperty(r,"__class__",{value:i,enumerable:!1,writable:!0}),i},t.GetClassNameByClass=function(t){var e;return e},t.CheckNameValide=function(t){return""==t||null==t?[!1,"名字不能为空"]:t.length>10?[!1,"名字过长"]:[!0,"ok"]},t.showBreathTween=function(t,e,r){if(egret.Tween.removeTweens(t),1==e){t.scaleX=1,t.scaleY=1;var n=null!=r.scale?r.scale:1.02,a=null!=r.time?r.time:1e3;egret.Tween.get(t,{loop:!0}).to({scaleX:n,scaleY:n},a).to({scaleX:1,scaleY:1},a)}},t.GetKaIcon=function(t){return"heroicon_"+t+"_png"},t.GetQualityBg=function(t){return"bg_card_di_"+t+"_png"},t.GetHeadIcon=function(t){return 10>t?"playericon_0"+t:"playericon_"+t},t.GetHeadFrame=function(t){return 10>t?"bg_phb_heroicon_up0"+t:"bg_phb_heroicon_up"+t},t}();__reflect(Utils.prototype,"Utils");var astar;!function(t){var e=function(){function t(){this.init()}return t.prototype.init=function(){this.hCost=10,this.costArray=[14,10,14,10,10,14,10,14],this.posArray=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]]},t.prototype.destroy=function(){},t.prototype.findPath=function(t,e,r,n,a){this.grid=a,this.openArray=[],this.closeArray=[],this.startNode=this.grid.getNode(t,e),this.endNode=this.grid.getNode(r,n),this.grid=a,this.tmpPath=this.search();var i=this.floydPath(this.tmpPath);return i},t.prototype.search=function(){var t=this.startNode;for(this.openArray.push(t);t!=this.endNode&&(t=this.getMinFNode(),null!=t);){this.closeArray.push(t);for(var e=void 0,r=0,n=8;n>r;r++)if(e=this.grid.getNode(t.x+this.posArray[r][0],t.y+this.posArray[r][1]),null!=e){if(e.x==this.endNode.x&&e.y==this.endNode.y)return e.parent=t,this.packPath();this.closeArray.indexOf(e)>=0||0!=e.walkable&&(0!=e.g&&t.g+this.costArray[r]>e.g||(e.parent=t,e.g=e.parent.g+this.costArray[r],e.h=(Math.abs(this.endNode.y-e.y)+Math.abs(this.endNode.x-e.x))*this.hCost,e.f=e.g+e.h,this.openArray.push(e)))}if(this.openArray.length<=0)return[]}return[]},t.prototype.floydPath=function(t){for(var e,r,n,a,i,o=0;o<t.length&&(e=t[o],r=t[o+1],n=t[o+2],null!=e&&null!=r&&null!=n);o++)1!=(r.y-e.y==0&&n.y-r.y==0)&&1!=(r.x-e.x==0&&n.x-r.x==0)?(a=(r.x-e.x)/(r.y-e.y),i=(n.x-r.x)/(n.y-r.y),a==i&&(t.splice(o+1,1),o--)):(t.splice(o+1,1),o--);for(var s,l=t.length,o=l-1;o>=0;o--)for(var h=0;o-2>=h;h++)if(s=this.checkIsCross(t[o].x,t[o].y,t[h].x,t[h].y),!s){for(var u=o-1;u>h;u--)t.splice(u,1);o=h+1,l=t.length;break}return t},t.prototype.packPath=function(){for(var t=this.endNode,e=[this.grid.getNode(t.x,t.y)];t!=this.startNode&&(t=t.parent,null!=t);)e.unshift(this.grid.getNode(t.x,t.y));for(var r=[].concat(this.openArray,this.closeArray),n=0,a=r;n<a.length;n++){var i=a[n];i.resetGHF()}return e},t.prototype.getMinFNode=function(){for(var t,e=0,r=0,n=this.openArray;r<n.length;r++){var a=n[r];null==t?t=e:a.f<this.openArray[t].f&&(t=e),e++}return this.openArray.splice(t,1)[0]},t.prototype.checkIsCross=function(t,e,r,n){for(var a=war.WarDataMgr.Ins().space,i=t*a+.5*a,o=e*a+.5*a,s=r*a+.5*a,l=n*a+.5*a,h=this.grid.getNodeArray(),u=0,p=h;u<p.length;u++){var c=p[u];if(!c.walkable&&this.isLineCross(c,i,o,s,l))return!0}return!1},t.prototype.isLineCross=function(t,e,r,n,a){function i(t){return Math.abs(t)<.001?0:0>t?-1:1}function o(t,e,r,n){return t*r+e*n}function s(t,e,r,n){return t*n-e*r}function l(t,e,r,n,a,l){return 0==i(s(r-t,n-e,a-t,l-e))&&i(o(r-t,n-e,a-t,l-e))<=0}function h(t,e,r,n,a,o,h,u){var p=s(r-t,n-e,a-t,o-e),c=s(r-t,n-e,h-t,u-e),f=s(h-a,u-o,t-a,e-o),y=s(h-a,u-o,r-a,n-o);return i(p)*i(c)<0&&i(f)*i(y)<0?!0:0==i(p)&&l(a,o,t,e,r,n)?!0:0==i(c)&&l(h,u,t,e,r,n)?!0:0==i(f)&&l(t,e,a,o,h,u)?!0:0==i(y)&&l(r,n,a,o,h,u)?!0:!1}var u=war.WarDataMgr.Ins().space,p=t.x*u,c=p+u,f=t.y*u,y=f+u;if(e>=p&&c>=e&&n>=p&&c>=n&&r>=f&&y>=r&&a>=f&&y>=a)return!0;if(e==n&&r==a)return!1;var g=this.distanceFromPointToLine(p+u/2,f+u/2,e,r,n,a);return g>=1.42*u?!1:h(e,r,n,a,p,f,c,f)?!0:h(e,r,n,a,c,f,c,y)?!0:h(e,r,n,a,c,y,p,y)?!0:h(e,r,n,a,p,y,p,f)?!0:!1},t.prototype.distanceFromPointToLine=function(t,e,r,n,a,i){var o=i-n,s=r-a,l=a*n-r*i;return Math.abs(o)>0||Math.abs(s)>0?Math.abs(o*t+s*e+l)/Math.sqrt(o*o+s*s):0},t}();t.AStar=e,__reflect(e.prototype,"astar.AStar")}(astar||(astar={}));var ViewManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.uiMap=new Hash},e.prototype.destroy=function(){for(var t=0,e=this.uiMap.values();t<e.length;t++){var r=e[t];r.destroyAll()}this.uiMap.destroy(),this.uiMap=null},e.prototype.open=function(t,e){void 0===e&&(e=null);var r=t.prototype.__class__;if(null==r)return LogUtils.Error("不存在类名"),!1;if(1==this.uiMap.has(r))return LogUtils.Error("面板已经打开"),!1;try{var n=t,a=new n;this.uiMap.set(r,a)}catch(i){return LogUtils.Error("创建面板发生错误"),!1}return this.handleView(r,e)},e.prototype.close=function(t){var e;if("function"==typeof t)e=t.prototype.__class__;else{if("object"!=typeof t)return LogUtils.Error("参数有误"),!1;e=t.constructor.prototype.__class__}if(null==e)return LogUtils.Error("不存在类名"),!1;if(0==this.uiMap.has(e))return LogUtils.Warn("关闭不存在的面板 "+e),!1;var r=this.uiMap.get(e);return r.destroyAll(),null==r.parent?(LogUtils.Warn("面板没有父级"),!1):(r.parent.removeChild(r),null!=r.viewInfo.resGroup&&r.viewInfo.resGroup.length<=0&&null!=r.viewInfo.resGroupId&&ResManager.Ins().destroyGroup(r.viewInfo.resGroupId),this.uiMap.remove(e),r=null,!0)},e.prototype.getView=function(t){var e=Utils.GetClassNameByObj(t);return null==e?(LogUtils.Error("不存在类名"),null):0==this.uiMap.has(e)?(LogUtils.Warn("不存在面板 "+e),null):this.uiMap.get(e)},e.prototype.handleView=function(t,e){var r=this;if(void 0===e&&(e=null),0==this.uiMap.has(t))return LogUtils.Error("不存在面板 "+t),!1;var n=this.uiMap.get(t),a=n.viewInfo.layer,i=n.viewInfo.resGroup;return null!=i?(this.open(home.LoadingTips),ResManager.Ins().loadGroup(i,function(t){r.close(home.LoadingTips),n.initData(e),a.addChild(n),n.initView()},this,null,function(e){LogUtils.Error("加载面板失败 "+t)},0)):(n.initData(e),a.addChild(n),n.initView()),!0},e.Ins=function(){return null==e.Instance&&(e.Instance=new e),e.Instance},e}(DataBase);__reflect(ViewManager.prototype,"ViewManager");var ConfigManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.cfgMap=new Hash},e.prototype.destroy=function(){this.cfgMap.destroy()},e.prototype.set=function(t,e){return 0==LogUtils.CheckParamValid(t,e)?!1:1==this.cfgMap.has(t)?(LogUtils.Error("已存在配置"),!1):(this.cfgMap.set(t,e),!0)},e.prototype.remove=function(t){if(0==LogUtils.CheckParamValid(t))return!1;if(0==this.cfgMap.has(t))return LogUtils.Error("不存在配置"),!1;this.cfgMap.remove(t);return!0},e.prototype.get=function(t){return 0==LogUtils.CheckParamValid(t)?!1:0==this.cfgMap.has(t)?(LogUtils.Error("不存在配置"),!1):this.cfgMap.get(t)},e.Ins=function(){return null==e.instance&&(e.instance=new e),e.instance},e}(DataBase);__reflect(ConfigManager.prototype,"ConfigManager");var CollectData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.groupNameArray=[],this.priority=null,this.currIndex=0,this.itemsLoaded=0,this.itemsTotal=0,this.errLoadCount=0},e.prototype.destroy=function(){this.groupNameArray.length=0,this.groupNameArray=null,this.priority=null,this.currIndex=0,this.itemsLoaded=0,this.itemsTotal=0,this.errLoadCount=0},e.prototype.packDate=function(t,e,r,n,a,i){return void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),this.groupNameArray=t,this.priority=i,this.cbFn=e,this.errFn=a,this.thisObj=r,this.progFn=n,this},e.prototype.addErrCount=function(){this.errLoadCount++},e.prototype.isEnd=function(){return this.currIndex>=this.groupNameArray.length-1&&this.itemsLoaded>=this.itemsTotal},e.prototype.nextGroup=function(){return this.currIndex++,this.currGroup()},e.prototype.currGroup=function(){return this.groupNameArray[this.currIndex]},e.prototype.execCb=function(t){null!=this.cbFn&&null!=this.thisObj&&this.cbFn.call(this.thisObj,t)},e.prototype.execProg=function(t){null!=this.progFn&&null!=this.thisObj&&this.progFn.call(this.thisObj,t)},e.prototype.execErr=function(t){null!=this.errFn&&null!=this.thisObj&&this.errFn.call(this.thisObj,t)},e}(DataBase);__reflect(CollectData.prototype,"CollectData");var ResData=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.resName="",this.refCount=0},e.prototype.destroy=function(){this.resName="",this.refCount=0},e.prototype.packData=function(t){return this.resName=t,this.refCount=0,this},e.prototype.reduceRefCount=function(t){this.refCount=Math.max(this.refCount-1,0),this.refCount<=0&&(this.destroyTime=t+ResManager.Ins().READY_DERTROY_SECOND)},e.prototype.addRefCount=function(){this.refCount++,this.destroyTime=null},e}(DataBase);__reflect(ResData.prototype,"ResData");var ResManager=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.Ins=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.init=function(){this.READY_DERTROY_SECOND=5e3,this.ERROR_LOAD_COUNT=5,this.DESTROY_ONCE_COUNT=20,this.isLoading=!1,this.resMap=new Hash,this.collectArray=[],this.useCollectArray=[],this.waitDestroyArray=[],RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.OnResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.OnResourceLoadProgress,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.OnResourceLoadError,this),TimerManager.Ins().addTimer(200,this.update,this)},e.prototype.destroy=function(){this.isLoading=!1,DataUtils.DestroyDataBaseArray(this.collectArray),DataUtils.DestroyDataBaseArray(this.useCollectArray),this.waitDestroyArray=[],TimerManager.Ins().removeTimer(this.update,this),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.OnResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.OnResourceLoadProgress,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.OnResourceLoadError,this)},e.prototype.loadGroup=function(t,e,r,n,a,i){if(void 0===e&&(e=null),void 0===r&&(r=null),void 0===n&&(n=null),void 0===a&&(a=null),void 0===i&&(i=null),null==t)return LogUtils.Error("【资源组集参数错误】"),null;if(t.length<=0)return null!=e&&null!=r&&e.call(r),null;for(var o=0,s=t;o<s.length;o++){var l=s[o];if(null==l||""==l||RES.getGroupByName(l).length<=0)return LogUtils.Error("【资源组集参数错误】"+t.toString()+" 可能包含不存在资源组，或者资源组子项为空"),null}var h=neww(CollectData);h.packDate(t,e,r,n,a,i),this.collectArray.push(h),this.collectArray.sort(this.sortByPriority);for(var u=0,p=t;u<p.length;u++)for(var l=p[u],c=0,f=RES.getGroupByName(l);c<f.length;c++){var y=f[c],g=y.name,d=void 0;0==this.resMap.has(g)&&(d=neww(ResData),d.packData(g),this.resMap.set(g,d)),d=this.resMap.get(g),d.addRefCount()}return LogUtils.Log("【资源组集加入到列表】id:"+h.uniqueCode+" "+t.toString()),h.uniqueCode},e.prototype.sortByPriority=function(t,e){return t.priority<e.priority?-1:1},e.prototype.destroyGroup=function(t){if(null==t||0>=t)return LogUtils.Error("【资源组集参数错误】"),!1;for(var e,r=0,n=this.collectArray;r<n.length;r++){var a=n[r];if(a.uniqueCode==t){e=a;var i=this.collectArray.indexOf(a);this.collectArray.splice(i,1);break}}if(null==e)for(var o=0,s=this.useCollectArray;o<s.length;o++){var a=s[o];if(a.uniqueCode==t){e=a;var i=this.useCollectArray.indexOf(a);this.collectArray.splice(i,1);break}}return null==e?this.currCollectData.uniqueCode==t?(this.waitDestroyArray.push(t),LogUtils.Warn("【资源组集正在在加载中，稍后释放】id:"+t),!0):(LogUtils.Warn("【销毁不存在的资源组集】id:"+t),!0):(this.reduceRefCount(e),e.destroyAll(),removee(e),e=null,LogUtils.Log("【销毁资源组集】id:"+t),!0)},e.prototype.loadRes=function(t){if(null==t||""==t)return LogUtils.Warn("【加载资源错误】参数错误"),null;if(0==RES.hasRes(t))return LogUtils.Warn("【加载资源错误】资源管理器不存在该配置"),null;var e=RES.getRes(t);if(null==e)return LogUtils.Log("【资源未先加载到内存】resName:"+t),null;var r;return 0==this.resMap.has(t)&&(r=neww(ResData),r.packData(t),this.resMap.set(t,r)),r=this.resMap.get(t),r.addRefCount(),LogUtils.Log("【加载资源】resName:"+t),e},e.prototype.destroyRes=function(t){if(null==t||""==t)return LogUtils.Warn("【加载资源错误】参数错误"),null;if(0==RES.hasRes(t))return LogUtils.Warn("【加载资源错误】资源管理器不存在该配置"),null;var e;return 0==this.resMap.has(t)?(LogUtils.Log("【销毁资源】resName:"+t),!0):(e=this.resMap.get(t),e.reduceRefCount(egret.getTimer()),LogUtils.Log("【销毁资源】resName:"+t),!0)},e.prototype.OnResourceLoadComplete=function(t){if(LogUtils.Log("【加载资源组完成】id:"+this.currCollectData.uniqueCode+" groupName:"+t.groupName),this.isLoading=!1,1==this.currCollectData.isEnd()){if(this.waitDestroyArray.length<=0)this.currCollectData.execCb(t),this.useCollectArray.push(this.currCollectData),LogUtils.Log("【加载资源组集完成】id:"+this.currCollectData.uniqueCode);else for(var e=0,r=0,n=this.waitDestroyArray;r<n.length;r++){var a=n[r];if(this.currCollectData.uniqueCode==a){this.waitDestroyArray.splice(e,1),this.reduceRefCount(this.currCollectData),this.currCollectData.destroyAll(),removee(this.currCollectData),LogUtils.Log("【销毁已完成的资源组集】id:"+this.currCollectData.uniqueCode);break}e++}this.currCollectData=null}},e.prototype.OnResourceLoadProgress=function(t){this.currCollectData.itemsLoaded=t.itemsLoaded,this.currCollectData.itemsTotal=t.itemsTotal,this.currCollectData.execProg(t),LogUtils.Log("【加载资源】id:"+this.currCollectData.uniqueCode+" groupName:"+t.groupName+" resName:"+t.resItem.name)},e.prototype.OnResourceLoadError=function(t){this.currCollectData.addErrCount(),this.currCollectData.errLoadCount<=this.ERROR_LOAD_COUNT?(LogUtils.Warn("【重新加载资源组】id:"+this.currCollectData.uniqueCode+" groupName:"+t.groupName+" count:"+this.currCollectData.errLoadCount),this.reloadGroup(t.groupName)):(LogUtils.Error("【加载资源组错误】id:"+this.currCollectData.uniqueCode+" groupName:"+t.groupName+" count:"+this.currCollectData.errLoadCount),1==this.currCollectData.isEnd()&&(this.currCollectData=null),this.loadNextGroup())},e.prototype.update=function(){0==this.isLoading&&(this.isLoading=this.loadNextGroup());for(var t=egret.getTimer(),e=0,r=this.resMap.values(),n=0,a=r;n<a.length;n++){var i=a[n];if(i.refCount<=0&&t>=i.destroyTime&&null!=RES.getRes(i.resName)&&(LogUtils.Log("【加载资源】resName:"+i.resName),RES.destroyRes(i.resName),this.resMap.remove(i.resName),i.destroyAll(),removee(i),e++),e>=this.DESTROY_ONCE_COUNT)break}return!0},e.prototype.loadNextGroup=function(){if(null==this.currCollectData){if(this.collectArray.length<=0)return!1;this.currCollectData=this.collectArray.shift();var t=this.currCollectData.currGroup();return RES.loadGroup(t),LogUtils.Log("【加载资源组】id:"+this.currCollectData.uniqueCode+" groupName:"+t),!0}var t=this.currCollectData.nextGroup();return RES.loadGroup(t),LogUtils.Log("【加载资源组】id:"+this.currCollectData.uniqueCode+" groupName:"+t),!0},e.prototype.reloadGroup=function(t){RES.loadGroup(t)},e.prototype.reduceRefCount=function(t){for(var e=egret.getTimer(),r=0,n=t.groupNameArray;r<n.length;r++)for(var a=n[r],i=0,o=RES.getGroupByName(a);i<o.length;i++){var s=o[i],l=s.name,h=void 0;0!=this.resMap.has(l)&&(h=this.resMap.get(l),h.reduceRefCount(e))}},e}(DataBase);__reflect(ResManager.prototype,"ResManager");var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.icon=0,this.frame=0},r.prototype.destroy=function(){this.icon=0,this.frame=0;var e=t.HomeDataMgr.Ins();e.removeAttrListener("icon",this.OnRefreshIcon,this),e.removeAttrListener("frame",this.OnRefreshFrame,this)},r.prototype.packData=function(e,r){this.icon=e,this.frame=r;var n=t.HomeDataMgr.Ins();return n.addAttrListener("icon",this.OnRefreshIcon,this),n.addAttrListener("frame",this.OnRefreshFrame,this),this},r.prototype.OnRefreshIcon=function(){var e=t.HomeDataMgr.Ins();this.setAttr("icon",e.myData.icon)},r.prototype.OnRefreshFrame=function(){var e=t.HomeDataMgr.Ins();this.setAttr("frame",e.myData.frame)},r}(DataBase);t.HeadIconData=e,__reflect(e.prototype,"home.HeadIconData");var r=function(t){function e(){return t.call(this,"HeadIconSkin")||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){null!=this.info&&(this.info.removeAttrListener("icon",this.OnRefreshIcon,this),this.info.removeAttrListener("frame",this.OnRefreshFrame,this),this.info.destroyAll())},e.prototype.dataChanged=function(){},e.prototype.OnRefreshIcon=function(){this.headIcon.source=Utils.GetHeadIcon(this.info.icon)},e.prototype.OnRefreshFrame=function(){this.headFrame.source=Utils.GetHeadFrame(this.info.frame)},e}(UIBase);t.HeadIcon=r,__reflect(r.prototype,"home.HeadIcon")}(home||(home={}));var war;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initData=function(t,e){var r=RES.getRes(t+"_json"),n=RES.getRes(t+"_png"),a=new egret.MovieClipDataFactory(r,n);this.movieClipData=a.generateMovieClipData(e)},e.prototype.startPlay=function(t,e){this.currAction!=t&&(this.currAction=t,this.gotoAndPlay(t,e))},e}(egret.MovieClip);t.MovieClip=e,__reflect(e.prototype,"war.MovieClip")}(war||(war={}));var WButton=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.touchChildren=!1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initData()},e.prototype.initData=function(){ListenerMgr.Ins().addEventListen(this,egret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,this),ListenerMgr.Ins().addEventListen(this,egret.Event.REMOVED_FROM_STAGE,this.destroy,this)},e.prototype.destroy=function(){ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,this),ListenerMgr.Ins().removeEventListen(this,egret.Event.REMOVED_FROM_STAGE,this.destroy,this)},e.prototype.OnTouchBegin=function(t){ListenerMgr.Ins().addEventListen(this,egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.target.OnTouchCancle,this),ListenerMgr.Ins().addEventListen(this,egret.TouchEvent.TOUCH_END,t.target.OnStageTouchEnd,this),t.target.scaleX=t.target.scaleY=.9},e.prototype.OnTouchCancle=function(t){ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.target.OnTouchCancle,this),ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_END,t.target.OnStageTouchEnd,this),t.target.scaleX=t.target.scaleY=1},e.prototype.OnStageTouchEnd=function(t){ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.target.OnTouchCancle,this),ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_END,t.target.OnStageTouchEnd,this),t.target.scaleX=t.target.scaleY=1},e}(eui.Button);__reflect(WButton.prototype,"WButton");var WGroup=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.touchChildren=!1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initData()},e.prototype.initData=function(){ListenerMgr.Ins().addEventListen(this,egret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,this),ListenerMgr.Ins().addEventListen(this,egret.Event.REMOVED_FROM_STAGE,this.destroy,this)},e.prototype.destroy=function(){ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_BEGIN,this.OnTouchBegin,this),ListenerMgr.Ins().removeEventListen(this,egret.Event.REMOVED_FROM_STAGE,this.destroy,this)},e.prototype.OnTouchBegin=function(t){ListenerMgr.Ins().addEventListen(this,egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.target.OnTouchCancle,this),ListenerMgr.Ins().addEventListen(this,egret.TouchEvent.TOUCH_END,t.target.OnStageTouchEnd,this),t.target.scaleX=t.target.scaleY=.9},e.prototype.OnTouchCancle=function(t){ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.target.OnTouchCancle,this),ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_END,t.target.OnStageTouchEnd,this),t.target.scaleX=t.target.scaleY=1},e.prototype.OnStageTouchEnd=function(t){ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,t.target.OnTouchCancle,this),ListenerMgr.Ins().removeEventListen(this,egret.TouchEvent.TOUCH_END,t.target.OnStageTouchEnd,this),t.target.scaleX=t.target.scaleY=1},e}(eui.Group);__reflect(WGroup.prototype,"WGroup");var astar;!function(t){var e=function(e){function r(){var t=e.call(this)||this;return t.init(),t.touchChildren=!1,t.touchEnabled=!0,t}return __extends(r,e),r.prototype.init=function(){this.numCols=100,this.numRows=200,this.space=10,this.astar=new t.AStar,this.initData()},r.prototype.destroy=function(){this.grid.destroy(),this.grid=null,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTap,this)},r.prototype.initData=function(){var e=new eui.Rect;e.width=this.space*this.numCols,e.height=this.space*this.numRows,this.addChild(e);var r=new egret.Shape,n=new egret.Shape;r.graphics.lineStyle(1,16776960),n.graphics.beginFill(16776960),this.grid=new t.Grid,this.grid.init(this.numRows,this.numCols,this.space,war.WarDataMgr.Ins().mapCfg);for(var a=0,i=this.numRows;i>a;a++)for(var o=0,s=this.numCols;s>o;o++){var l=o*this.space,h=a*this.space;r.graphics.drawRect(l,h,this.space,this.space)}r.graphics.endFill(),n.graphics.endFill(),this.addChild(r),this.addChild(n),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.OnTap,this)},r.prototype.OnTap=function(t){var e=Math.floor(t.localX/this.space),r=Math.floor(t.localY/this.space);null==this.pathShap&&(this.pathShap=new egret.Shape,this.addChild(this.pathShap)),this.pathShap.graphics.clear(),this.pathShap.graphics.beginFill(16711680),null==this.astar.startNode&&null==this.astar.endNode?(this.astar.startNode=this.grid.getNode(0,0),this.astar.endNode=this.grid.getNode(e,r)):(this.astar.startNode=this.astar.endNode,this.astar.endNode=this.grid.getNode(e,r));for(var n=this.astar.findPath(this.astar.startNode.x,this.astar.startNode.y,this.astar.endNode.x,this.astar.endNode.y,this.grid),a=0,i=n;a<i.length;a++){var o=i[a];this.pathShap.graphics.drawRect(o.x*this.space,o.y*this.space,this.space,this.space)}this.pathShap.graphics.endFill()},r}(eui.Component);t.AStarTest=e,__reflect(e.prototype,"astar.AStarTest")}(astar||(astar={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.familyId=null,this.icon=null,this.frame=null,this.desc=null,this.memberMap=new Hash},e.prototype.destroy=function(){DataUtils.DestroyDataBaseMap(this.memberMap)},e.prototype.packData=function(){},e}(DataBase);t.FamilyData=e,__reflect(e.prototype,"home.FamilyData")}(home||(home={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.kaId=0,this.level=0},e.prototype.destroy=function(){this.kaId=0,this.level=0},e.prototype.packData=function(t,e){this.kaId=t,this.level=e},Object.defineProperty(e.prototype,"cfg",{get:function(){var t=ConfigManager.Ins().get(CONFIG.HERO)[this.kaId];return t},enumerable:!0,configurable:!0}),e}(DataBase);t.KaData=e,__reflect(e.prototype,"home.KaData")}(home||(home={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.playerId=null,this.iconId=null,this.iconFrameId=null,this.level=null,this.exp=null,this.playerName=null,this.cups=null,this.teamArray=[],this.kaMap=new Hash},e.prototype.destroy=function(){DataUtils.DestroyDataBaseMap(this.kaMap)},e}(DataBase);t.PlayerData=e,__reflect(e.prototype,"home.PlayerData")}(home||(home={}));var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){},r.prototype.destroy=function(){},r.prototype.addFamily=function(e,r){var n=t.HomeDataMgr.Ins().myData.kaMap;if(1==n.has(e))return LogUtils.Error("已存在此"),!1;var a=PoolManager.Ins().pop(t.KaData);return a.packData(e,r),n.set(e,a),!0},r.prototype.removeKa=function(e){var r=t.HomeDataMgr.Ins().myData.kaMap;if(0==r.has(e))return LogUtils.Error("不存在卡"),!1;var n=r.remove(e);return n.destroyAll(),PoolManager.Ins().push(n),!0},r}(DataBase);t.FamilyDataMgr=e,__reflect(e.prototype,"home.FamilyDataMgr")}(home||(home={}));var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.Ins=function(){return null==r.instance&&(r.instance=new r),r.instance},r.prototype.init=function(){this.myData=PoolManager.Ins().pop(t.PlayerData),this.kaDataMgr=new t.KaDataMgr},r.prototype.destroy=function(){this.myData.destroyAll(),PoolManager.Ins().push(this.myData),this.kaDataMgr.destroyAll(),this.kaDataMgr=null},r.prototype.packMyData=function(){this.myData.playerId=1000001,this.myData.iconId=1,this.myData.iconFrameId=1,this.myData.level=1,this.myData.exp=0,this.myData.playerName="wsx",this.myData.cups=0,this.myData.teamArray=[10010,10040,10050,10070,10080,10090,10100,10110];var t=[1,1,1,2,2,2,3,3],e=0;this.myData.kaMap=new Hash;for(var n=0,a=this.myData.teamArray;n<a.length;n++){var i=a[n];r.Ins().kaDataMgr.addKa(i,t[e]),e++}},r}(DataBase);t.HomeDataMgr=e,__reflect(e.prototype,"home.HomeDataMgr")}(home||(home={}));var DemoPanel=home.DemoPanel,Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.initLifecycle(),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return t.sent(),[4,RES.loadConfig("resource/war.res.json","resource/")];case 2:return t.sent(),[4,RES.loadConfig("resource/home.res.json","resource/")];case 3:return t.sent(),[4,RES.loadConfig("resource/config.res.json","resource/")];case 4:return t.sent(),[4,this.loadTheme()];case 5:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.initLifecycle=function(){window.onerror=function(t,e,r,n,a){console.warn(a.stack)},egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter)},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,r){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){GameUtils.main=this,LayerManager.Ins(),NetManager.Ins(),NetManager.Ins().initData(),war.WarDataMgr.Ins(),ViewManager.Ins().open(home.LoginPanel)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){},e}(DataBase);t.RankDataMgr=e,__reflect(e.prototype,"home.RankDataMgr")}(home||(home={}));var astar;!function(t){var e=function(){function e(){}return e.prototype.init=function(e,r,n,a){this.numRows=e,this.numCols=r,this.space=n,this.nodeArray=[];for(var i,o,s=0,l=this.numRows;l>s;s++){for(var h=[],u=0,p=this.numCols;p>u;u++){i=u,o=s;var c=new t.Node;c.init(i,o,a[o][i]),h.push(c)}this.nodeArray.push(h)}},e.prototype.destroy=function(){for(var t=0,e=this.numRows;e>t;t++){for(var r=0,n=this.numCols;n>r;r++)this.nodeArray[t][r].destroy(),this.nodeArray[t][r]=null;this.nodeArray[t].length=0,this.nodeArray[t]=null}this.nodeArray.length=0,this.nodeArray=null},e.prototype.getNode=function(t,e){return null==this.nodeArray[e]?null:this.nodeArray[e][t]},e.prototype.setWalkable=function(t,e,r){return null==this.nodeArray[e]||null==this.nodeArray[e][t]?!1:(this.nodeArray[e][t].walkable=r,!0)},e.prototype.getNodeArray=function(){for(var t=[],e=0,r=this.nodeArray;e<r.length;e++)for(var n=r[e],a=0,i=n;a<i.length;a++){var o=i[a];t.push(o)}return t},e}();t.Grid=e,__reflect(e.prototype,"astar.Grid")}(astar||(astar={}));var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.resGroup=[],this.layer=LayerManager.Ins().Panel,this.kaDataArray=[]},r.prototype.destroy=function(){DataUtils.DestroyDataBaseArray(this.kaDataArray),this.kaDataArray.length=0},r.prototype.packData=function(){for(var e=t.HomeDataMgr.Ins().myData.teamArray,r=0,n=e;r<n.length;r++){var a=n[r],i=PoolManager.Ins().pop(t.HeroKaData);
i.packData(a),this.kaDataArray.push(i)}},r}(ViewData);t.HomePanelData=e,__reflect(e.prototype,"home.HomePanelData");var r=function(r){function n(){return r.call(this,"HomePanelSkin",e)||this}return __extends(n,r),n.prototype.init=function(){},n.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},n.prototype.initData=function(t){this.info.packData()},n.prototype.initView=function(){this.initKa();var e=t.HomeDataMgr.Ins();this.cups.label=String(e.myData.cups),this.playerName.text=e.myData.playerName,this.addEvent(this.fightBtn,egret.TouchEvent.TOUCH_TAP,this.OnFightTap,this),this.addEvent(this.kaBtn,egret.TouchEvent.TOUCH_TAP,this.OnKaTap,this)},n.prototype.initKa=function(){for(var e=0,r=this.info.kaDataArray.length;r>e;e++){var n=neww(t.HeroKa);n.data=this.info.kaDataArray[e],n.x=14+226*(e%2),n.y=0+141*Math.floor(e/2),this.kaGroup.addChild(n)}},n.prototype.OnFightTap=function(){ViewManager.Ins().close(this),ViewManager.Ins().open(war.WarMatchPanel)},n.prototype.OnKaTap=function(){ViewManager.Ins().open(t.KakuPanel)},n}(ViewBase);t.HomePanel=r,__reflect(r.prototype,"home.HomePanel")}(home||(home={}));var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){},r.prototype.destroy=function(){},r.prototype.packData=function(e){var r=this,n=t.HomeDataMgr.Ins().myData.kaMap.get(e);null!=n&&(this.kaId=n.kaId,this.level=n.level,this.addAttrCB(n,"level",function(){r.canUp=10010==r.kaId,r.updateAttr("level")},this))},r}(DataBase);t.HeroKaData=e,__reflect(e.prototype,"home.HeroKaData");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroKaSkin",e}return __extends(e,t),e.prototype.init=function(){this.touchChildren=!1},e.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},e.prototype.dataChanged=function(){if(null!=this.data){this.info=this.data;var t=ConfigManager.Ins().get(CONFIG.HERO)[this.info.kaId];this.costLb.text=String(t.cost),this.typeBg.source=Utils.GetQualityBg(t.quality),this.kaImg.source=Utils.GetKaIcon(this.info.kaId),this.level.text=this.info.level+"级",this.testId.text=""+this.info.kaId,this.testId.visible=GameData.DevelopMode==DevelopMode.DEBUG,this.info.addAttrListener("level",this.OnShowUpTips,this)}},e.prototype.OnShowUpTips=function(){this.upTips.visible=this.info.canUp},e}(WItemRenderBase);t.HeroKa=r,__reflect(r.prototype,"home.HeroKa")}(home||(home={}));var home;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.resGroup=[],this.layer=LayerManager.Ins().Panel},r.prototype.destroy=function(){this.heroKaData.destroyAll(),removee(this.heroKaData)},r.prototype.packData=function(e){var r=t.HomeDataMgr.Ins().myData.kaMap.get(e);return null==r?null:(this.heroId=e,this.heroKaData=neww(t.HeroKaData),this.heroKaData.packData(e),this)},r}(ViewData);t.HeroKa2Data=e,__reflect(e.prototype,"home.HeroKa2Data");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroKa2Skin",e}return __extends(e,t),e.prototype.init=function(){},e.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},e.prototype.packData=function(t){null!=t&&(this.info=t,this.heroKa.data=this.info.heroKaData,this.setState(!1),this.heroKa.data=this.info.heroKaData)},e.prototype.setState=function(t){1==t?this.currentState="active":this.currentState="common"},e}(WItemRenderBase);t.HeroKa2=r,__reflect(r.prototype,"home.HeroKa2")}(home||(home={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.resGroup=[],this.layer=LayerManager.Ins().Panel},e.prototype.destroy=function(){this.selKa=null},e.prototype.packData=function(){},e}(ViewData);t.KakuPanelData=e,__reflect(e.prototype,"home.KakuPanelData");var r=function(r){function n(){return r.call(this,"KakuPanelSkin",e)||this}return __extends(n,r),n.prototype.init=function(){},n.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},n.prototype.initData=function(t){this.info.packData()},n.prototype.initView=function(){for(var e,r,n=t.HomeDataMgr.Ins().myData.kaMap.keys(),a=0,i=0,o=n;i<o.length;i++){var s=o[i];e=PoolManager.Ins().pop(t.HeroKa2Data),e.packData(s),r=PoolManager.Ins().pop(t.HeroKa2),r.packData(e),r.x=225*(a%3),r.y=143*Math.floor(a/3),this.heroGroup.addChild(r),a++}this.readyBg.mask=this.maskk,this.addEvent(this.heroGroup,egret.TouchEvent.TOUCH_TAP,this.OnHeroGroupTap,this),this.addEvent(this.readyBg,egret.TouchEvent.TOUCH_TAP,this.OnReaBgTap,this)},n.prototype.OnHeroGroupTap=function(t){var e=t.target;if("heroKa"==e.name){null!=this.info.selKa&&this.info.selKa.setState(!1);var r=e.parent;r.setState(!0),this.heroGroup.setChildIndex(r,777),this.info.selKa=r}else if("infoBtn"==e.name)var r=e.parent;else if("fightBtn"==e.name){var r=e.parent;this.readGroup.visible=!0,null!=this.info.selKa&&this.info.selKa.setState(!1)}},n.prototype.OnReaBgTap=function(t){this.readGroup.visible=!1},n}(ViewBase);t.KakuPanel=r,__reflect(r.prototype,"home.KakuPanel")}(home||(home={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.resGroup=["loading"],this.layer=LayerManager.Ins().Panel},e.prototype.destroy=function(){},e.prototype.packData=function(){this.currCount=0,this.resGroupArray=["common_preload","war_preload"],this.cfgGroupArray=["hero_json","upgrade_json"]},e}(ViewData);t.LoadingPanelData=e,__reflect(e.prototype,"home.LoadingPanelData");var r=function(r){function n(){return r.call(this,"LoadingPanelSkin",e)||this}return __extends(n,r),n.prototype.init=function(){this.info.packData()},n.prototype.destroy=function(){null!=this.info&&this.info.destroyAll(),Utils.showBreathTween(this.bg,!1)},n.prototype.initData=function(t){this.info.packData()},n.prototype.initView=function(){this.loadRes(),Utils.showBreathTween(this.bg,!0,{time:1e3})},n.prototype.loadRes=function(){this.bar.minimum=0,this.bar.value=0,ResManager.Ins().loadGroup(this.info.resGroupArray,this.OnLoadGroupOk,this,this.OnLoadGroupProgress,this.OnLoadGroupError)},n.prototype.OnLoadGroupOk=function(t){this.loadCfg()},n.prototype.OnLoadGroupProgress=function(t){this.bar.maximum=t.itemsTotal,this.bar.value=t.itemsLoaded},n.prototype.OnLoadGroupError=function(t){},n.prototype.loadCfg=function(){var t=this;ResManager.Ins().loadGroup(["config_preload"],function(){for(var e=RES.getGroupByName("config_preload"),r=0,n=e;r<n.length;r++){var a=n[r];ConfigManager.Ins().set(a.name,RES.getRes(a.name))}t.loadOK()},this)},n.prototype.loadOK=function(){ViewManager.Ins().close(this),ViewManager.Ins().open(t.HomePanel)},n}(ViewBase);t.LoadingPanel=r,__reflect(r.prototype,"home.LoadingPanel")}(home||(home={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.layer=LayerManager.Ins().Tips},e.prototype.destroy=function(){},e.prototype.packData=function(){},e}(ViewData);t.LoadingTipsData=e,__reflect(e.prototype,"home.LoadingTipsData");var r=function(t){function r(){return t.call(this,"LoadingTipsSkin",e)||this}return __extends(r,t),r.prototype.init=function(){this.info.packData()},r.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},r.prototype.initData=function(t){this.info.packData()},r.prototype.initView=function(){},r}(ViewBase);t.LoadingTips=r,__reflect(r.prototype,"home.LoadingTips")}(home||(home={}));var home;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.resGroup=[],this.layer=LayerManager.Ins().Panel},e.prototype.destroy=function(){},e.prototype.packData=function(){},e}(ViewData);t.LoginPanelData=e,__reflect(e.prototype,"home.LoginPanelData");var r=function(r){function n(){return r.call(this,"LoginPanelSkin",e)||this}return __extends(n,r),n.prototype.init=function(){},n.prototype.destroy=function(){null!=this.info&&this.info.destroyAll(),this.loginBtn.destroy()},n.prototype.initData=function(t){this.info.packData()},n.prototype.initView=function(){this.accountInput.text="wsx",this.addEvent(this.loginBtn,egret.TouchEvent.TOUCH_TAP,this.OnLoginTap,this)},n.prototype.OnLoginTap=function(e){var r=this,n=Utils.CheckNameValide(this.accountInput.text);return 0==n[0]?void alert(n[1]):void net.NetLogin.C2SLogin(this.accountInput.text,function(){ViewManager.Ins().close(r),ViewManager.Ins().open(t.LoadingPanel)},this)},n}(ViewBase);t.LoginPanel=r,__reflect(r.prototype,"home.LoginPanel")}(home||(home={}));var net;!function(t){var e=function(){function t(){}return t.prototype.init=function(){NetManager.Ins().setNet(0,t.S2CLogin,this)},t.prototype.destroy=function(){},t.C2SLogin=function(e,r,n){t.C2SLogin_CBFn=r,t.C2SLogin_thisObj=n;var a=!0;a&&(home.HomeDataMgr.Ins(),home.HomeDataMgr.Ins().packMyData(),t.C2SLogin_CBFn.call(t.C2SLogin_thisObj))},t.S2CLogin=function(){},t}();t.NetLogin=e,__reflect(e.prototype,"net.NetLogin")}(net||(net={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.mapId=1001,this.mapCfg=MapCfg[String(this.mapId)],this.numCols=36,this.mapCfg[0].length,this.numRows=16,this.mapCfg.length,this.space=30,this.startX=100,this.startY=120,this.world=new t.World,this.entityMap=new Hash,this.inputArray=[],this.initGrid()},r.prototype.destroy=function(){DataUtils.DestroyUIBaseMap(this.entityMap),DataUtils.DestroyDataBaseArray(this.inputArray),this.astar.destroy(),this.grid.destroy(),this.astar=null,this.grid=null},r.prototype.startWar=function(){egret.startTick(this.update,this)},r.prototype.endWar=function(){egret.stopTick(this.update,this)},r.prototype.update=function(t){void 0===t&&(t=null);try{this.world.update(t)}catch(e){}return!0},r.prototype.addEntity=function(t){return 1==this.entityMap.has(t.id)?!1:void this.entityMap.set(t.id,t)},r.prototype.removeEntity=function(t){return 0==this.entityMap.has(t)?null:this.entityMap.remove(t)},r.prototype.destroyEntity=function(t){if(0==this.entityMap.has(t))return!1;var e=this.entityMap.remove(t);null!=e&&e.destroyAll(),PoolManager.Ins().push(e)},r.prototype.initGrid=function(){this.astar=new astar.AStar,this.grid=new astar.Grid,this.grid.init(this.numRows,this.numCols,this.space,this.mapCfg),this.pathMap=new Hash},r.prototype.findPath=function(t,e,r,n){var a,i=t+"_"+e+"_"+r+"_"+n;return 1==this.pathMap.has(i)?(a=this.pathMap.get(i),DataUtils.CopyArray(a)):(a=this.astar.findPath(t,e,r,n,this.grid),this.pathMap.set(i,a),a)},r.Ins=function(){return null==r.instance&&(r.instance=new r),r.instance},r}(DataBase);t.WarDataMgr=e,__reflect(e.prototype,"war.WarDataMgr")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.sysArray=[],this.inputSystem=new t.InputSystem,this.sysArray.push(this.inputSystem),this.moveSystem=new t.MoveSystem,this.sysArray.push(this.moveSystem),this.pathSystem=new t.PathSystem,this.sysArray.push(this.pathSystem),this.speedSystem=new t.SpeedSystem,this.sysArray.push(this.speedSystem),this.actionSystem=new t.ActionSystem,this.sysArray.push(this.actionSystem),this.collisionSystem=new t.CollisionSystem,this.sysArray.push(this.collisionSystem)},r.prototype.destroy=function(){DataUtils.DestroyDataBaseClass(this.inputSystem,!0),DataUtils.DestroyDataBaseClass(this.moveSystem,!0),DataUtils.DestroyDataBaseClass(this.actionSystem,!0),DataUtils.DestroyDataBaseClass(this.collisionSystem,!0),this.sysArray.length=0},r.prototype.update=function(e){this.inputSystem.update(e);for(var r,n=t.WarDataMgr.Ins(),a=DataUtils.CopyArray(n.entityMap.values()),i=0,o=a.length;o>i;i++)r=a[i],null!=r&&(this.speedSystem.update(r,e),this.moveSystem.update(r,e),this.pathSystem.update(r,e),this.actionSystem.update(r,e),this.collisionSystem.update(r,e))},r.prototype.updateSystem=function(e){for(var r=(t.WarDataMgr.Ins(),0),n=this.sysArray;r<n.length;r++){var a=n[r];a.update(e)}},r}(DataBase);t.World=e,__reflect(e.prototype,"war.World")}(war||(war={}));var MapCfg={1001:[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]]},war;!function(t){var e=function(){function e(){}return e.Destroy=function(){if(null!=this.pathMap){for(var t=0,e=this.pathMap.keys();t<e.length;t++){var r=e[t],n=this.pathMap.get(Number(r));null!=n.parent&&n.parent.removeChild(n),n=null}this.pathMap.destroy()}if(null!=this.colorMap){for(var a=0,i=this.colorMap.values();a<i.length;a++){var o=i[a];o.matrix=null,o=null}this.pathMap.destroy()}},e.DrawGrid=function(r){if(0!=e.isTest){var n=t.WarDataMgr.Ins().grid.space,a=t.WarDataMgr.Ins().grid.numCols,i=t.WarDataMgr.Ins().grid.numRows,o=new egret.Shape;o.graphics.lineStyle(1,65280);for(var s=MapCfg[1001],l=0,h=a;h>l;l++)for(var u=0,p=i;p>u;u++){var c=n*l,f=n*u;if(0==s[u][l]){var y=new egret.Shape;y.x=o.x,y.y=o.y,y.graphics.beginFill(255),y.graphics.drawRect(c,f,n,n),y.graphics.endFill(),r.addChild(y)}o.graphics.drawRect(c,f,n,n)}o.graphics.endFill(),r.addChild(o)}},e.DrawPath=function(r){if(0!=e.isTest){var n=r.parent;if(null==this.pathMap&&(this.pathMap=new Hash),0==this.pathMap.has(r.uniqueCode)){var a=new egret.Shape;a.x=t.WarDataMgr.Ins().startX,a.y=t.WarDataMgr.Ins().startY,null!=n&&n.addChild(a),this.pathMap.set(r.uniqueCode,a)}var i=this.pathMap.get(r.uniqueCode),o=t.WarDataMgr.Ins().grid.space,s=r.getCom(t.COMPONENT.PATH);if(null!=s){i.graphics.clear(),i.graphics.lineStyle(2,16711680),i.graphics.moveTo(r.x-t.WarDataMgr.Ins().startX,r.y-t.WarDataMgr.Ins().startY);for(var l=s.getLeftPath(),h=1;h<l.length;h++){var u=l[h];i.graphics.lineTo(o*u.x+o/2,o*u.y+o/2)}i.graphics.endFill()}else null!=i.parent&&i.parent.removeChild(i)}},e.DrawHeroAnchor=function(r){if(0!=e.isTest){var n=r.getCom(t.COMPONENT.CAMP);if(null!=n){var a=new egret.Shape;n.camp==t.CAMP.WE?a.graphics.beginFill(16777215):n.camp==t.CAMP.ENEMY&&a.graphics.beginFill(0),a.graphics.lineStyle(2,0),a.graphics.drawCircle(0,0,4),a.graphics.endFill(),r.addChildAt(a,777)}}},e.DrawHeroId=function(t){if(0!=e.isTest){var r=new eui.Label;r.text=""+t.uniqueCode,r.stroke=2,r.strokeColor=0,r.x=t.width>>1,r.y=-50,t.addChild(r)}},e.DrawGrigd=function(e){if(0!=e.hasCom(t.COMPONENT.GRIGD)){var r=e.getCom(t.COMPONENT.GRIGD),n=new egret.Shape;n.graphics.beginFill(16776960),n.graphics.lineStyle(1,0),n.graphics.drawCircle(0,0,r.radius),n.graphics.endFill(),e.addChildAt(n,0)}},e.SetColor=function(t,e,r,n,a,i){if(void 0===i&&(i=1),null==this.colorMap&&(this.colorMap=new Hash),0==this.colorMap.has(t.uniqueCode)){var o=new egret.ColorMatrixFilter;this.colorMap.set(t.uniqueCode,o),t.filters=[o]}var s=this.colorMap.get(t.uniqueCode);if(0==e)return void(s.matrix=null);var l=(r<<16)+(n<<8)+a;if(!egret.WebGLUtils.checkCanUseWebGL())return void(t.tint=l);if(256==r&&256==n&&256==a)t.filters=null;else{var h=[1,0,0,0,100,0,1,0,0,100,0,0,1,0,100,0,0,0,1,0];h[0]=r/255,h[6]=n/255,h[12]=a/255,h[4]=i,h[9]=i,h[14]=i,s.matrix=h}},e.DrawAttackRange=function(r){if(0!=e.isTest){var n=r.getCom(t.COMPONENT.ATTACK);if(null!=n){var a=new egret.Shape;a.name="attackCom_"+r.uniqueCode,a.graphics.beginFill(16776960),a.graphics.lineStyle(1,0),a.graphics.drawCircle(0,0,n.range),a.graphics.endFill(),r.addChildAt(a,0)}}},e.isTest=!0,e}();t.DrawUtils=e,__reflect(e.prototype,"war.DrawUtils")}(war||(war={}));var astar;!function(t){var e=function(){function t(){this.walkable=!0}return t.prototype.init=function(t,e,r){this.resetGHF(),this.x=t,this.y=e,this.walkable=r},t.prototype.destroy=function(){},t.prototype.resetGHF=function(){this.g=0,this.h=0,this.f=this.g+this.h},t}();t.Node=e,__reflect(e.prototype,"astar.Node")}(astar||(astar={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,r){function n(n){e.call(r,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var war;!function(t){var e;!function(t){t[t.SPEED=1]="SPEED",t[t.ACTION=2]="ACTION",t[t.PATH=3]="PATH",t[t.GRIGD=4]="GRIGD",t[t.ATTACK=5]="ATTACK",t[t.CAMP=6]="CAMP",t[t.INPUT=7]="INPUT",t[t.HP=8]="HP"}(e=t.COMPONENT||(t.COMPONENT={}));var r;!function(t){t[t.MOVE=1]="MOVE",t[t.ACTION=2]="ACTION",t[t.COLLISION=3]="COLLISION",t[t.PATH=4]="PATH"}(r=t.SYSTEM||(t.SYSTEM={}));var n;!function(t){t[t.WE=1]="WE",t[t.ENEMY=2]="ENEMY"}(n=t.CAMP||(t.CAMP={}));var a;!function(t){t[t.STAND=1]="STAND",t[t.RUN=2]="RUN",t[t.ATTACK=3]="ATTACK"}(a=t.ACTION||(t.ACTION={}));var i;!function(t){t[t.NONE=0]="NONE",t[t.UP=1]="UP",t[t.RIGHT_UP=2]="RIGHT_UP",t[t.RIGHT=3]="RIGHT",t[t.RIGHT_DOWN=4]="RIGHT_DOWN",t[t.DOWN=5]="DOWN",t[t.LEFT_DOWN=6]="LEFT_DOWN",t[t.LEFT=7]="LEFT",t[t.LEFT_UP=8]="LEFT_UP"}(i=t.DIRECTION||(t.DIRECTION={}));var o;!function(t){t[t.QUEEN=1]="QUEEN",t[t.HERO=2]="HERO"}(o=t.ENTITY||(t.ENTITY={}));var s=function(){function t(){}return t.RIGHT=[337.5,22.5],t.RIGHT_DOWN=[22.5,67.5],t.DOWN=[67.5,112.5],t.LEFT_DOWN=[112.5,157.5],t.LEFT=[157.5,202.5],t.LEFT_UP=[202.5,247.5],t.UP=[247.5,292.5],t.RIGHT_UP=[292.5,337.5],t}();t.ANGLE=s,__reflect(s.prototype,"war.ANGLE");var l;!function(t){t[t.NONE=0]="NONE",t[t.CREATE_HERO=1]="CREATE_HERO",t[t.CREATE_QUEEN=2]="CREATE_QUEEN",t[t.CREATE_KING=3]="CREATE_KING"}(l=t.INPUT||(t.INPUT={}))}(war||(war={}));var war;!function(t){var e=function(){function e(){}return e.Init=function(){},e.Destroy=function(){},e.ToRealPos=function(e,r){var n=t.WarDataMgr.Ins().space,a=t.WarDataMgr.Ins().startX+n*e+(n>>1),i=t.WarDataMgr.Ins().startY+n*r+(n>>1);return[a,i]},e.ToLocalX=function(e){return t.WarDataMgr.Ins().startX+t.WarDataMgr.Ins().space*e+(t.WarDataMgr.Ins().space>>1)},e.ToLocalY=function(e){return t.WarDataMgr.Ins().startY+t.WarDataMgr.Ins().space*e+(t.WarDataMgr.Ins().space>>1)},e.ToGridXY=function(e,r){var n=t.WarDataMgr.Ins().space,a=Math.floor((e-t.WarDataMgr.Ins().startX)/n),i=Math.floor((r-t.WarDataMgr.Ins().startY)/n);return[a,i]},e.ToGridX=function(e){var r=t.WarDataMgr.Ins().space,n=Math.floor((e-t.WarDataMgr.Ins().startX)/r);return n},e.ToGridY=function(e){var r=t.WarDataMgr.Ins().space,n=Math.floor((e-t.WarDataMgr.Ins().startY)/r);return n},e.CreateEntity=function(e){var r;return e==t.ENTITY.QUEEN?r=PoolManager.Ins().pop(t.QueenEntity):e==t.ENTITY.HERO&&(r=PoolManager.Ins().pop(t.HeroEntity)),r},e.CheckXYRangeValide=function(e,r){return 0>e||0>r?!1:e>=t.WarDataMgr.Ins().numCols||r>=t.WarDataMgr.Ins().numRows?!1:!0},e}();t.WarUtils=e,__reflect(e.prototype,"war.WarUtils")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.ACTION,this.direction=t.DIRECTION.DOWN,this.action=t.ACTION.STAND,this.hasChanged=!0},r.prototype.destroy=function(){},r.prototype.setActionAndDir=function(t,e){this.direction=e,this.action=t,this.hasChanged=!0},r.prototype.setAction=function(t){this.action=t,this.hasChanged=!0},r.prototype.setDirByXY=function(e,r){var n=this.direction;(e!=t.DIRECTION.NONE||r!=t.DIRECTION.NONE)&&(e==t.DIRECTION.RIGHT&&r==t.DIRECTION.NONE?this.direction=t.DIRECTION.RIGHT:e==t.DIRECTION.LEFT&&r==t.DIRECTION.NONE?this.direction=t.DIRECTION.LEFT:e==t.DIRECTION.NONE&&r==t.DIRECTION.UP?this.direction=t.DIRECTION.UP:e==t.DIRECTION.NONE&&r==t.DIRECTION.DOWN?this.direction=t.DIRECTION.DOWN:e==t.DIRECTION.LEFT&&r==t.DIRECTION.UP?this.direction=t.DIRECTION.LEFT_UP:e==t.DIRECTION.LEFT&&r==t.DIRECTION.DOWN?this.direction=t.DIRECTION.LEFT_DOWN:e==t.DIRECTION.RIGHT&&r==t.DIRECTION.UP?this.direction=t.DIRECTION.RIGHT_UP:e==t.DIRECTION.RIGHT&&r==t.DIRECTION.DOWN&&(this.direction=t.DIRECTION.DOWN),n!=this.direction&&(this.hasChanged=!0))},r.prototype.setDir=function(t){this.direction=t,this.hasChanged=!0},r}(t.ComBase);t.ActionCom=e,__reflect(e.prototype,"war.ActionCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.ATTACK},r.prototype.destroy=function(){},r.prototype.setRange=function(t){this.range=t},r}(t.ComBase);t.AttackCom=e,__reflect(e.prototype,"war.AttackCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.CAMP},r.prototype.destroy=function(){},r}(t.ComBase);t.CampCom=e,__reflect(e.prototype,"war.CampCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.HP},r.prototype.destroy=function(){},r.prototype.setHp=function(t){this.hp=t},r}(t.ComBase);t.HealthCom=e,__reflect(e.prototype,"war.HealthCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.INPUT,this.inputType=t.INPUT.NONE},r.prototype.destroy=function(){this.inputType=t.INPUT.NONE},r.prototype.packHero=function(t,e,r,n,a,i,o){return this.inputType=t,this.x1=e,this.x2=n,this.y1=r,this.y2=a,this.camp=o,this.parent=i,this},r.prototype.packQueen=function(t,e,r,n,a){return this.inputType=t,this.x1=e,this.y1=r,this.camp=a,this.parent=n,this},r.prototype.packKing=function(t,e,r,n,a){return this.inputType=t,this.x1=e,this.y1=r,this.camp=a,this.parent=n,this},r}(t.ComBase);t.InputCom=e,__reflect(e.prototype,"war.InputCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.PATH,this.path=[],this.currStep=-1},r.prototype.destroy=function(){this.destroyPath(),this.path.length=0},r.prototype.setPath=function(t){this.destroyPath(),this.path=t,this.currStep=0},r.prototype.getPath=function(){return this.path},r.prototype.getLeftPath=function(){return this.path.slice(Math.max(this.currStep-1,0))},r.prototype.getEndNode=function(){return this.path[this.path.length-1]},r.prototype.getCurr=function(){return this.path[this.currStep]},r.prototype.getLast=function(){return this.path[this.currStep-1]},r.prototype.getNext=function(){return this.path[this.currStep+1]},r.prototype.getEnd=function(){return this.path[this.path.length-1]},r.prototype.toNext=function(){return this.currStep++,this.getCurr()},r.prototype.destroyPath=function(){for(var t=0,e=this.path;t<e.length;t++){var r=e[t];null!=r&&(r.destroy(),PoolManager.Ins().push(r))}},r}(t.ComBase);t.PathCom=e,__reflect(e.prototype,"war.PathCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.componentId=t.COMPONENT.GRIGD,this.radius=0},r.prototype.destroy=function(){},r}(t.ComBase);t.RangeCom=e,__reflect(e.prototype,"war.RangeCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.angle=45,this.speed=0,this.componentId=t.COMPONENT.SPEED},r.prototype.destroy=function(){this.speed=0,this.angle=0},r}(t.ComBase);t.SpeedCom=e,__reflect(e.prototype,"war.SpeedCom")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.init=function(){this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height,this.mc=new t.MovieClip,this.mc.initData("hero_10010","hero_10010"),this.mc.startPlay("run0",-1),this.addChild(this.mc),t.DrawUtils.DrawHeroId(this)},r.prototype.destroy=function(){},r}(t.EntityBase);t.HeroEntity=e,__reflect(e.prototype,"war.HeroEntity")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.init=function(){this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height,this.mc=new t.MovieClip,this.mc.initData("hero_10010","hero_10010"),this.mc.startPlay("stand4",-1),this.addChild(this.mc);var e=new t.RangeCom;e.radius=30,this.setCom(e),t.DrawUtils.DrawHeroId(this),t.DrawUtils.DrawHeroAnchor(this)},r.prototype.destroy=function(){},r}(t.EntityBase);t.KingEntity=e,__reflect(e.prototype,"war.KingEntity")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.init=function(){this.anchorOffsetX=this.width>>1,this.anchorOffsetY=this.height,this.mc=new t.MovieClip,this.mc.initData("hero_10010","hero_10010"),this.mc.startPlay("stand4",-1),this.addChild(this.mc),t.DrawUtils.DrawHeroId(this),t.DrawUtils.DrawHeroAnchor(this)},r.prototype.destroy=function(){},r}(t.EntityBase);t.QueenEntity=e,__reflect(e.prototype,"war.QueenEntity")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.systemId=t.SYSTEM.ACTION},r.prototype.destroy=function(){},r.prototype.update=function(e,r){if(null!=e){var n=e.getCom(t.COMPONENT.ACTION);if(null!=n){var a=e.getCom(t.COMPONENT.SPEED);null!=a&&(n.action==t.ACTION.RUN?this.setRun(e):n.action==t.ACTION.STAND?this.setStand(e):n.action==t.ACTION.ATTACK&&this.setAttack(e))}}},r.prototype.setStand=function(e){var r=e.getCom(t.COMPONENT.ACTION),n=r.direction;n==t.DIRECTION.UP?(e.mc.scaleX=1,e.mc.startPlay("stand0",-1)):n==t.DIRECTION.RIGHT_UP?(e.mc.scaleX=1,e.mc.startPlay("stand1",-1)):n==t.DIRECTION.RIGHT?(e.mc.scaleX=1,e.mc.startPlay("stand2",-1)):n==t.DIRECTION.RIGHT_DOWN?(e.mc.scaleX=1,e.mc.startPlay("stand3",-1)):n==t.DIRECTION.DOWN?(e.mc.scaleX=1,e.mc.startPlay("stand4",-1)):n==t.DIRECTION.LEFT_DOWN?(e.mc.scaleX=-1,e.mc.startPlay("stand3",-1)):n==t.DIRECTION.LEFT?(e.mc.scaleX=-1,e.mc.startPlay("stand2",-1)):n==t.DIRECTION.LEFT_UP&&(e.mc.scaleX=-1,e.mc.startPlay("stand1",-1))},r.prototype.setRun=function(e){var r=e.getCom(t.COMPONENT.SPEED),n=e.getCom(t.COMPONENT.ACTION),a=r.angle;t.WarDataMgr.Ins();a>t.ANGLE.UP[0]&&a<=t.ANGLE.UP[1]?(n.setDir(t.DIRECTION.UP),e.mc.scaleX=1,e.mc.startPlay("run0",-1)):a>t.ANGLE.RIGHT_UP[0]&&a<=t.ANGLE.RIGHT_UP[1]?(n.setDir(t.DIRECTION.RIGHT_UP),e.mc.scaleX=1,e.mc.startPlay("run1",-1)):a>t.ANGLE.RIGHT[0]||a<=t.ANGLE.RIGHT[1]?(n.setDir(t.DIRECTION.RIGHT),e.mc.scaleX=1,e.mc.startPlay("run2",-1)):a>t.ANGLE.RIGHT_DOWN[0]&&a<=t.ANGLE.RIGHT_DOWN[1]?(n.setDir(t.DIRECTION.RIGHT_DOWN),e.mc.scaleX=1,e.mc.startPlay("run3",-1)):a>t.ANGLE.DOWN[0]&&a<=t.ANGLE.DOWN[1]?(n.setDir(t.DIRECTION.DOWN),e.mc.scaleX=1,e.mc.startPlay("run4",-1)):a>t.ANGLE.LEFT_DOWN[0]&&a<=t.ANGLE.LEFT_DOWN[1]?(n.setDir(t.DIRECTION.LEFT_DOWN),e.mc.scaleX=-1,e.mc.startPlay("run3",-1)):a>t.ANGLE.LEFT[0]&&a<=t.ANGLE.LEFT[1]?(n.setDir(t.DIRECTION.LEFT),e.mc.scaleX=-1,e.mc.startPlay("run2",-1)):a>t.ANGLE.LEFT_UP[0]&&a<=t.ANGLE.LEFT_UP[1]&&(n.setDir(t.DIRECTION.LEFT_UP),e.mc.scaleX=-1,e.mc.startPlay("run1",-1))},r.prototype.setAttack=function(e){var r=e.getCom(t.COMPONENT.SPEED),n=e.getCom(t.COMPONENT.ACTION),a=r.angle;t.WarDataMgr.Ins();a>t.ANGLE.UP[0]&&a<=t.ANGLE.UP[1]?(n.setDir(t.DIRECTION.UP),e.mc.scaleX=1,e.mc.startPlay("attack0",-1)):a>t.ANGLE.RIGHT_UP[0]&&a<=t.ANGLE.RIGHT_UP[1]?(n.setDir(t.DIRECTION.RIGHT_UP),e.mc.scaleX=1,e.mc.startPlay("attack1",-1)):a>t.ANGLE.RIGHT[0]||a<=t.ANGLE.RIGHT[1]?(n.setDir(t.DIRECTION.RIGHT),e.mc.scaleX=1,e.mc.startPlay("attack2",-1)):a>t.ANGLE.RIGHT_DOWN[0]&&a<=t.ANGLE.RIGHT_DOWN[1]?(n.setDir(t.DIRECTION.RIGHT_DOWN),e.mc.scaleX=1,e.mc.startPlay("attack3",-1)):a>t.ANGLE.DOWN[0]&&a<=t.ANGLE.DOWN[1]?(n.setDir(t.DIRECTION.DOWN),e.mc.scaleX=1,e.mc.startPlay("attack4",-1)):a>t.ANGLE.LEFT_DOWN[0]&&a<=t.ANGLE.LEFT_DOWN[1]?(n.setDir(t.DIRECTION.LEFT_DOWN),e.mc.scaleX=-1,e.mc.startPlay("attack3",-1)):a>t.ANGLE.LEFT[0]&&a<=t.ANGLE.LEFT[1]?(n.setDir(t.DIRECTION.LEFT),e.mc.scaleX=-1,e.mc.startPlay("attack2",-1)):a>t.ANGLE.LEFT_UP[0]&&a<=t.ANGLE.LEFT_UP[1]&&(n.setDir(t.DIRECTION.LEFT_UP),e.mc.scaleX=-1,e.mc.startPlay("attack1",-1))},r}(t.SystemBase);t.ActionSystem=e,__reflect(e.prototype,"war.ActionSystem")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.systemId=t.SYSTEM.COLLISION},r.prototype.destroy=function(){},r.prototype.update=function(e,r){if(null!=e){var n,a,i,o=t.WarDataMgr.Ins(),s=o.entityMap.values(),l=[];if(a=e.getCom(t.COMPONENT.GRIGD),null!=a){for(var h=0,u=s.length;u>h;h++)if(n=s[h],null!=n&&e.uniqueCode!=n.uniqueCode&&(i=n.getCom(t.COMPONENT.GRIGD),null!=i)){var p=MathUtils.IsCircleIntersect(e.x,e.y,a.radius,n.x,n.y,i.radius);if(0!=p){l.push(n);break}}if(l.length<=0)t.DrawUtils.SetColor(e,!1,255,0,0);else{t.DrawUtils.SetColor(e,!0,255,0,0);e.getCom(t.COMPONENT.CAMP),l[0].getCom(t.COMPONENT.CAMP);this.toAttack(e,l[0])}l.length=0}}},r.prototype.toAttack=function(e,r){var n=e.getCom(t.COMPONENT.ACTION);if(null!=n){var a=e.getCom(t.COMPONENT.SPEED);if(null!=a){var i=MathUtils.CalcAngle(e.x,e.y,r.x,r.y);a.angle=i,a.speed=0,n.setAction(t.ACTION.ATTACK)}}},r}(t.SystemBase);t.CollisionSystem=e,__reflect(e.prototype,"war.CollisionSystem")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.systemId=t.SYSTEM.MOVE},r.prototype.destroy=function(){},r.prototype.update=function(e){for(var r=t.WarDataMgr.Ins();r.inputArray.length>0;){var n=r.inputArray.shift();null!=n&&(n.inputType==t.INPUT.CREATE_HERO?this.createHero(n):n.inputType==t.INPUT.CREATE_QUEEN?this.createQueen(n):n.inputType==t.INPUT.CREATE_KING&&this.createKing(n))}},r.prototype.createHero=function(e){var r=PoolManager.Ins().pop(t.HeroEntity);r.x=t.WarUtils.ToLocalX(e.x1),r.y=t.WarUtils.ToLocalY(e.y1);var n=PoolManager.Ins().pop(t.SpeedCom);n.speed=.5,n.angle=0,r.setCom(n);var a=PoolManager.Ins().pop(t.PathCom),i=t.WarDataMgr.Ins().findPath(e.x1,e.y1,e.x2,e.y2);a.setPath(i),r.setCom(a);var o=new t.ActionCom;
o.setActionAndDir(t.ACTION.RUN,t.DIRECTION.DOWN),r.setCom(o);var s=new t.RangeCom;s.radius=20,r.setCom(s);var l=new t.CampCom;l.camp=Math.random()>.5?t.CAMP.WE:t.CAMP.ENEMY,r.setCom(l),t.DrawUtils.DrawGrigd(r),t.DrawUtils.DrawHeroAnchor(r),e.parent.addChild(r),t.WarDataMgr.Ins().addEntity(r)},r.prototype.createQueen=function(e){var r=PoolManager.Ins().pop(t.QueenEntity);r.x=t.WarUtils.ToLocalX(e.x1),r.y=t.WarUtils.ToLocalY(e.y1);var n=new t.ActionCom;n.setActionAndDir(t.ACTION.RUN,t.DIRECTION.DOWN),r.setCom(n);var a=new t.RangeCom;a.radius=20,r.setCom(a);var i=new t.CampCom;i.camp=Math.random()>.5?t.CAMP.WE:t.CAMP.ENEMY,r.setCom(i),t.DrawUtils.DrawGrigd(r),t.DrawUtils.DrawHeroAnchor(r);var o=new t.RangeCom;o.radius=30,r.setCom(o);var s=new t.HealthCom;s.setHp(100),r.setCom(s),e.parent.addChild(r),t.WarDataMgr.Ins().addEntity(r)},r.prototype.createKing=function(e){var r=PoolManager.Ins().pop(t.QueenEntity);r.x=t.WarUtils.ToLocalX(e.x1),r.y=t.WarUtils.ToLocalY(e.y1);var n=new t.ActionCom;n.setActionAndDir(t.ACTION.RUN,t.DIRECTION.DOWN),r.setCom(n);var a=new t.RangeCom;a.radius=20,r.setCom(a);var i=new t.CampCom;i.camp=Math.random()>.5?t.CAMP.WE:t.CAMP.ENEMY,r.setCom(i),t.DrawUtils.DrawGrigd(r),t.DrawUtils.DrawHeroAnchor(r),e.parent.addChild(r),t.WarDataMgr.Ins().addEntity(r)},r}(t.SystemBase);t.InputSystem=e,__reflect(e.prototype,"war.InputSystem")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.systemId=t.SYSTEM.MOVE},r.prototype.destroy=function(){},r.prototype.update=function(e,r){if(null!=e){var n=e.getCom(t.COMPONENT.SPEED);if(null!=n){var a=MathUtils.CalcLegSide(n.speed,n.angle),i=a[0],o=a[1];e.x=Number((e.x+i).toFixed(2)),e.y=Number((e.y+o).toFixed(2))}}},r}(t.SystemBase);t.MoveSystem=e,__reflect(e.prototype,"war.MoveSystem")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.systemId=t.SYSTEM.PATH},r.prototype.destroy=function(){},r.prototype.update=function(e,r){t.WarDataMgr.Ins();if(null!=e){var n=e.getCom(t.COMPONENT.PATH);if(null!=n){t.DrawUtils.DrawPath(e);var a=n.getCurr();if(null!=a){var i=n.getLast(),o=t.WarUtils.ToRealPos(a.x,a.y);if(null!=i){var s=t.WarUtils.ToLocalX(i.x),l=t.WarUtils.ToLocalY(i.y),h=MathUtils.CalcDistance(s,l,o[0],o[1]),u=MathUtils.CalcDistance(s,l,e.x,e.y);if(u>=h)n.toNext();else{var p=e.getCom(t.COMPONENT.SPEED);null!=p&&(p.angle=MathUtils.CalcAngle(e.x,e.y,o[0],o[1]))}}else n.toNext()}else try{}catch(c){}}}},r}(t.SystemBase);t.PathSystem=e,__reflect(e.prototype,"war.PathSystem")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.systemId=t.SYSTEM.PATH},r.prototype.destroy=function(){},r.prototype.update=function(e,r){if(null!=e){var n=e.getCom(t.COMPONENT.SPEED);if(null!=n){var a=e.getCom(t.COMPONENT.PATH);null!=a&&this.calcByPath(e,r)}}},r.prototype.calcByPath=function(e,r){var n=e.getCom(t.COMPONENT.SPEED);if(null!=n){var a=e.getCom(t.COMPONENT.PATH);if(null!=a){var i=a.getCurr(),o=t.WarUtils.ToRealPos(i.x,i.y),s=MathUtils.CalcAngle(e.x,e.y,o[0],o[1]);n.angle=s;var l=MathUtils.CalcLegSide(n.speed,n.angle),h=l[0],u=l[1];(0>h&&e.x<o[0]||h>0&&e.x>o[0]||0>u&&e.y<o[1]||u>0&&e.y>o[1])&&(e.x=o[0],e.y=o[1],a.toNext())}}},r}(t.SystemBase);t.SpeedSystem=e,__reflect(e.prototype,"war.SpeedSystem")}(war||(war={}));var war;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.CostBar=e,__reflect(e.prototype,"war.CostBar")}(war||(war={}));var war;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Component);t.Ka1=e,__reflect(e.prototype,"war.Ka1")}(war||(war={}));var war;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.resGroup=["war_preload"],this.layer=LayerManager.Ins().Panel},e.prototype.destroy=function(){},e.prototype.packData=function(){},e}(ViewData);t.WarMatchPanelData=e,__reflect(e.prototype,"war.WarMatchPanelData");var r=function(r){function n(){return r.call(this,"WarMatchPanelSkin",e)||this}return __extends(n,r),n.prototype.init=function(){this.info.packData()},n.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},n.prototype.initData=function(t){this.info.packData(),this.addEvent(this.nextBtn,egret.TouchEvent.TOUCH_TAP,this.OnTap,this)},n.prototype.initView=function(){},n.prototype.OnTap=function(){ViewManager.Ins().close(this),ViewManager.Ins().open(t.WarPanel)},n}(ViewBase);t.WarMatchPanel=r,__reflect(r.prototype,"war.WarMatchPanel")}(war||(war={}));var war;!function(t){var e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.init=function(){this.resGroup=[],this.layer=LayerManager.Ins().Panel},r.prototype.destroy=function(){t.WarDataMgr.Ins().endWar(),t.WarDataMgr.Ins().destroyAll()},r.prototype.packData=function(){t.WarDataMgr.Ins(),t.WarDataMgr.Ins().startWar()},r}(ViewData);t.WarPanelData=e,__reflect(e.prototype,"war.WarPanelData");var r=function(r){function n(){return r.call(this,"WarPanelSkin",e)||this}return __extends(n,r),n.prototype.init=function(){},n.prototype.destroy=function(){null!=this.info&&this.info.destroyAll()},n.prototype.initData=function(t){this.info.packData()},n.prototype.initView=function(){t.DrawUtils.DrawGrid(this.testGrid),this.initEntity(),this.addEvent(this.entityGroup,egret.TouchEvent.TOUCH_TAP,this.OnEntityGroupTap,this)},n.prototype.OnEntityGroupTap=function(e){var r=t.WarUtils.ToGridX(e.localX),n=t.WarUtils.ToGridY(e.localY);if(0==t.WarUtils.CheckXYRangeValide(r,n))return LogUtils.Error("丢卡的位置有误"),!1;var a=PoolManager.Ins().pop(t.InputCom);a.packHero(t.INPUT.CREATE_HERO,r,n,26,3,this.entityGroup,t.CAMP.WE),t.WarDataMgr.Ins().inputArray.push(a)},n.prototype.initEntity=function(){var e=PoolManager.Ins().pop(t.InputCom);e.packQueen(t.INPUT.CREATE_QUEEN,7,3,this.entityGroup,t.CAMP.WE),t.WarDataMgr.Ins().inputArray.push(e);var r=PoolManager.Ins().pop(t.InputCom);r.packQueen(t.INPUT.CREATE_QUEEN,7,12,this.entityGroup,t.CAMP.WE),t.WarDataMgr.Ins().inputArray.push(r);var n=PoolManager.Ins().pop(t.InputCom);n.packQueen(t.INPUT.CREATE_QUEEN,26,3,this.entityGroup,t.CAMP.ENEMY),t.WarDataMgr.Ins().inputArray.push(n);var a=PoolManager.Ins().pop(t.InputCom);a.packQueen(t.INPUT.CREATE_QUEEN,26,12,this.entityGroup,t.CAMP.ENEMY),t.WarDataMgr.Ins().inputArray.push(a);var i=PoolManager.Ins().pop(t.InputCom);i.packKing(t.INPUT.CREATE_KING,3,7,this.entityGroup,t.CAMP.WE),t.WarDataMgr.Ins().inputArray.push(i);var o=PoolManager.Ins().pop(t.InputCom);o.packKing(t.INPUT.CREATE_KING,32,7,this.entityGroup,t.CAMP.ENEMY),t.WarDataMgr.Ins().inputArray.push(o)},n}(ViewBase);t.WarPanel=r,__reflect(r.prototype,"war.WarPanel")}(war||(war={}));